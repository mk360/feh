/*! For license information please see main.c9345c777b426e6279a3.bundle.js.LICENSE.txt */
(()=>{var e,t={181:(e,t,s)=>{"use strict";var a=s(260);const i="#EAEAA6",o="#89D5E3",n="#E99EAE",r="#FFFFFF",l="#F2C42A",d="#87F640",h="#CA384D",c="#F5D04C";function p(e,t,s,a,i){return new Phaser.GameObjects.Text(e,t,s,a.toString(),Object.assign({fontFamily:"'FEH'",stroke:"black",strokeThickness:2},i))}function m(e){const{text:t,gradient:s}=f(e);return s.addColorStop(0,"white"),s.addColorStop(.5,h),s.addColorStop(1,"white"),t.setFill(s),t}function g(e){const{text:t,gradient:s}=f(e);return s.addColorStop(0,"white"),s.addColorStop(1,l),t.setFill(s),t}function f(e){const t=p(e.scene,e.x,e.y,e.content,e.style),s=t.context.createLinearGradient(0,0,0,t.height);return{text:t,gradient:s}}class u extends a.GameObjects.Container{constructor(e,t,s,i,o){super(e,t,s),this.statusIndex=0,this.setData("hero",i),this.statuses=[],this.setName(i.id),this.image=new a.GameObjects.Image(e,0,0,i.name,"map").setScale(.7).setDepth(1),this.add(this.image),this.team=o,this.statusesImage=new a.GameObjects.Image(e,45,45,"").setVisible(!1);const n=this.statusesImage.getCenter().y;this.hpText=p(e,-15,n,i.maxHP,{fontSize:"18px"}).setOrigin(1,.5),this.hpBar=new a.GameObjects.Rectangle(e,this.hpText.getRightCenter().x,n,60,5,"team1"===o?5562356:16403817).setOrigin(0,0).setDepth(2),this.weaponType=new a.GameObjects.Image(e,-30,-40,"weapons",`${i.getWeapon().color}-${i.getWeapon().type}`),this.hpBarBackground=new a.GameObjects.Rectangle(e,this.hpBar.getLeftCenter().x-1,n-1,62,7,0).setOrigin(0,0),this.add(this.hpBarBackground),this.add(this.hpBar),this.add(this.weaponType),this.add(this.statusesImage);const r=this.hpText.context.createLinearGradient(0,0,0,this.hpText.height);r.addColorStop(0,"white"),r.addColorStop(.7,"team1"===this.team?"#54DFF4":"#FA4D69"),this.hpText.setFill(r),this.add(this.hpText),this.setSize(120,120)}getInternalHero(){return this.data.get("hero")}update(){const{maxHP:e,stats:{hp:t}}=this.getInternalHero();this.hpText.setText(t.toString());const s=t/e;this.hpBar.displayWidth=60*s}toggleStatuses(){this.statusesImage.setVisible(!!this.statuses.length),this.statuses.length&&(this.statusIndex+1===this.statuses.length?this.statusIndex=0:this.statusIndex++,this.statusesImage.setTexture(this.statuses[this.statusIndex]))}getMovementRange(){const{movementType:e}=this.getInternalHero();return"cavalry"===e?3:"armored"===e?1:2}getNextIndex(e,t){return t===e.length-1?0:t+1}getWeaponRange(){return["sword","lance","axe","dragonstone"].includes(this.getInternalHero().getWeapon().type)?1:2}}const w=u;class y extends a.GameObjects.Container{constructor(e,t,s,i){super(e,t,s),this.nameplate=new a.GameObjects.Image(e,0,0,"nameplate").setScale(.9,.5).setOrigin(0,.5),this.weaponIcon=new a.GameObjects.Image(e,this.nameplate.getLeftCenter().x+22,this.nameplate.getLeftCenter().y,"weapons",`${i.weaponColor}-${i.weaponType}`).setScale(1.2),this.heroName=p(e,this.nameplate.getCenter().x,this.nameplate.getCenter().y,i.name,{fontSize:"22px"}).setOrigin(.5),this.add([this.nameplate,this.weaponIcon,this.heroName])}updateNameplate({name:e,weaponType:t,weaponColor:s}){this.heroName.setText(e),this.weaponIcon.setFrame(`${s}-${t}`)}}const b=y;class k extends a.GameObjects.Container{constructor(e,t,s){super(e,t,s),this.contentContainer=new a.GameObjects.Rectangle(e,0,0,400,400,1258815).setOrigin(1,0).setAlpha(.9).setStrokeStyle(2,8377056),this.add(this.contentContainer)}setSkillDescription(e,t){this.skillDesc&&this.remove(this.skillDesc),this.skillName&&this.remove(this.skillName),this.skillName=function(e){const{text:t}=f(e);return t.setColor(c),t.setFontSize(18),t}({scene:this.scene,x:this.contentContainer.getLeftCenter().x+10,y:this.contentContainer.getTopCenter().y+10,content:e}),this.add(this.skillName),this.skillDesc=p(this.scene,this.contentContainer.getLeftCenter().x+10,this.skillName.getBottomCenter().y+10,t),this.add(this.skillDesc),this.skillDesc.setWordWrapWidth(390),this.contentContainer.setDisplaySize(this.contentContainer.displayWidth,this.skillDesc.getBottomCenter().y+10)}}const S=k;class x extends a.GameObjects.Container{constructor(e){super(e,0,0);this.add(new a.GameObjects.Image(e,0,0,"unit-banner-bg").setOrigin(0,0)),this.heroPortrait=new a.GameObjects.Image(e,-100,0,"").setOrigin(0),this.add(this.heroPortrait),this.add(new a.GameObjects.Image(e,170,70,"hp plate").setScale(1.15,.6).setOrigin(0,.5)),this.maxHP=g({scene:this.scene,x:310,y:56,content:"",style:{fontSize:"18px"}}),this.nameplate=new b(e,160,25,{name:"",weaponType:"",weaponColor:""});const t=p(e,590,15,"40",{fontSize:"20px"});this.atk=p(e,280,95,"",{fontSize:"18px"}).setOrigin(1,0).setColor(i),this.spd=p(e,390,95,"",{fontSize:"18px"}).setOrigin(1,0).setColor(i),this.def=p(e,280,125,"",{fontSize:"18px"}).setOrigin(1,0).setColor(i),this.res=p(e,390,125,"",{fontSize:"18px"}).setOrigin(1,0).setColor(i),this.add([this.nameplate]),this.add([this.atk,this.spd,this.def,this.res]),this.add(new a.GameObjects.Image(e,180,120,"stat-line").setScale(.2,.5).setOrigin(0)),this.add(new a.GameObjects.Image(e,180,150,"stat-line").setScale(.2,.5).setOrigin(0)),this.statLabels={atk:{object:p(e,190,95,"Atk",{fontSize:"18px"}),description:"The higher a unit's Atk, the more damage it will inflict on foes."},spd:{object:p(e,300,95,"Spd",{fontSize:"18px"}),description:"A unit will attack twice if its Spd is at least 5 more than its foe."},res:{object:p(e,300,125,"Res",{fontSize:"18px"}),description:"The higher a unit's Resistance is, the less damage it takes from magical attacks (spells, staves, breath effects, etc.)."},def:{object:p(e,190,125,"Def",{fontSize:"18px"}),description:"The higher a unit's Defense is, the less damage it takes from physical attacks (swords, axes, lances, etc.)."},hp:{object:p(e,190,54,"HP",{fontSize:"20px"}),description:"A unit is defeated if its Hit Points reach 0."}};for(let e in this.statLabels){const t=e;this.add(this.statLabels[t].object),this.statLabels[t].object.setInteractive().on("pointerdown",(()=>{const e=this.statLabels[t].description;this.skillInfos.setSkillDescription("",e),this.skillInfos.x=this.statLabels[t].object.x+400,this.skillInfos.y=this.statLabels[t].object.y+25,this.skillInfos.setVisible(!this.skillInfos.visible)}))}this.add(p(e,t.getLeftCenter().x,0,"Lv.",{fontSize:"14px"})),this.add(t),this.S=new a.GameObjects.Image(e,715,t.getBottomCenter().y,"").setScale(.5).setOrigin(0,1);const s=new a.GameObjects.Image(e,this.S.getBottomRight().x,this.S.getBottomRight().y,"S").setOrigin(1).setScale(.5);this.add(this.S),this.add(s),this.C=new a.GameObjects.Image(e,690,t.getBottomCenter().y,"").setScale(.5).setOrigin(0,1);const o=new a.GameObjects.Image(e,this.C.getBottomRight().x,this.C.getBottomRight().y,"C").setOrigin(1).setScale(.5);this.add(this.C),this.add(o),this.B=new a.GameObjects.Image(e,665,t.getBottomCenter().y,"").setScale(.5).setOrigin(0,1);const n=new a.GameObjects.Image(e,this.B.getBottomRight().x,this.B.getBottomRight().y,"B").setOrigin(1).setScale(.5);this.add(this.B),this.add(n),this.A=new a.GameObjects.Image(e,640,t.getBottomCenter().y,"").setScale(.5).setOrigin(0,1);const r=new a.GameObjects.Image(e,this.A.getBottomRight().x,this.A.getBottomRight().y,"A").setOrigin(1).setScale(.5);this.add(this.A),this.add(r),this.skillInfos=new S(e,this.S.getCenter().x+10,this.S.getBottomRight().y).setDepth(7).setVisible(!1),this.weaponBg=new a.GameObjects.Image(this.scene,490,45,"weapon-bg").setOrigin(0,0).setScale(.23,.25).setInteractive(),new a.GameObjects.Image(this.scene,490,85,"weapon-bg").setOrigin(0,0).setScale(.23,.25),new a.GameObjects.Image(this.scene,490,125,"weapon-bg").setOrigin(0,0).setScale(.23,.25),new a.GameObjects.Image(this.scene,490,105,"assist-icon").setScale(.45).setOrigin(.25,.5),new a.GameObjects.Image(this.scene,490,135,"special-icon").setScale(.45).setOrigin(.25,.5),this.add(this.weaponBg),this.weaponName=p(this.scene,this.weaponBg.getLeftCenter().x+30,this.weaponBg.getCenter().y,"").setOrigin(0,.5).setStyle({fontSize:"19px"}),this.add(this.weaponName),this.add(new a.GameObjects.Image(this.scene,490,this.weaponBg.getLeftCenter().y,"weapon-icon").setScale(.45).setOrigin(.25,.5)),this.currentHP=g({scene:this.scene,x:250,y:50,content:0,style:{fontSize:"26px"}}),this.add(this.currentHP),this.add(this.maxHP),this.add(this.skillInfos)}setHero(e){this.skillInfos.setVisible(!1);const t=e.getInternalHero(),s=t.getWeapon();if(this.weaponBg.off("pointerdown").on("pointerdown",(()=>{this.skillInfos.setVisible(!this.skillInfos.visible),this.skillInfos.setSkillDescription(s.name,s.description),this.skillInfos.y=this.weaponBg.y+40,this.skillInfos.x=750})),t.boon)this.statLabels[t.boon].object.setColor(o),this.statLabels[t.bane].object.setColor(n);else for(let e in this.statLabels){const t=e;this.statLabels[t].object.setColor("white")}this.heroPortrait.setTexture(t.name,t.stats.hp/t.maxHP<.5?"portrait-damage":"portrait"),this.currentHP.destroy();const a=t.stats.hp<10?m:g;this.currentHP=a({scene:this.scene,x:this.currentHP.x,y:this.currentHP.y,style:{fontSize:"26px"},content:t.stats.hp}),this.add(this.currentHP),this.nameplate.heroName.text!==t.name&&(this.heroPortrait.x=-300,this.scene.tweens.add({targets:this.heroPortrait,x:-100,duration:200})),this.nameplate.updateNameplate({name:t.name,weaponType:s.type,weaponColor:s.color}),this.maxHP.setText(`/ ${t.maxHP}`);const r=t.getMapStats(),l=t.stats;for(let e of["atk","def","res","spd"])this[e].setText(r[e].toString()),this[e].setColor(l[e]<r[e]?o:l[e]>r[e]?n:i);this.weaponName.setText(s.name);for(let e of["A","B","C","S"]){this[e].off("pointerdown");const s=t.skills[e];this[e].setTexture("skills",s.name),this[e].setName(s.name),this[e].setInteractive().on("pointerdown",(()=>{this.skillInfos.x=750,this.skillInfos.y=this[e].y,this.skillInfos.setSkillDescription(s.name,s.description),this.skillInfos.setVisible(!this.skillInfos.visible)}))}}}const v=x;class H extends a.GameObjects.Image{constructor(e,t){super(e,-100,0,`${t} battle`),this.setOrigin(0)}}const I=H;class C extends Phaser.GameObjects.Container{constructor(e){super(e,0,0),this.firstHero={previousHP:null,predictedHP:null,nameplate:null,portrait:null},this.secondHero={previousHP:null,predictedHP:null,nameplate:null,portrait:null},this.attackerStatMods=this.defenderStatMods=new a.GameObjects.Group(e),this.firstSideBg=new a.GameObjects.Rectangle(e,0,0,750,400,9272).setOrigin(0),this.add(this.firstSideBg),this.add(new a.GameObjects.Rectangle(e,750,0,750,400,10104088).setAlpha(.7)),this.add(new a.GameObjects.Image(e,0,0,"forecast-bg").setOrigin(0,0)),this.firstHero.portrait=new I(e,""),this.add(this.firstHero.portrait),this.secondHero.portrait=new I(e,"").setFlipX(!0).setX(1200).setOrigin(1,0),this.firstHero.nameplate=new b(e,100,20,{name:"",weaponType:"",weaponColor:""}),this.add(this.firstHero.nameplate);const t=45;this.secondHero.nameplate=new b(e,377,20,{name:"",weaponType:"",weaponColor:""});const s=new a.GameObjects.Image(e,250,70,"unit-bg").setScale(.5,.75),i=new a.GameObjects.Image(e,510,70,"unit-bg").setScale(.5,.75);this.add(this.secondHero.nameplate),this.add(this.secondHero.portrait),this.add([s,i]),this.add(p(e,this.firstSideBg.getCenter().x,70,"HP",{fontSize:"22px"}).setOrigin(.5)),this.firstHero.previousHP=g({scene:e,x:210,y:t,style:{fontSize:"36px"},content:""}).setOrigin(1,0),this.firstHero.predictedHP=g({scene:e,x:310,y:t,style:{fontSize:"36px"},content:""}).setOrigin(1,0),this.secondHero.previousHP=g({scene:e,content:"",style:{fontSize:"36px"},x:490,y:t}).setOrigin(1,0);const o=g({scene:e,x:500,y:t,content:"→",style:{fontSize:"36px"}}),n=g({scene:e,x:215,y:t,content:"→",style:{fontSize:"36px"}});this.secondHero.predictedHP=m({scene:e,content:0,x:550,y:t,style:{fontSize:"36px"}}),this.add(this.secondHero.previousHP),this.add(this.secondHero.predictedHP),this.add(o),this.add(n),this.add(this.firstHero.previousHP),this.add(this.firstHero.predictedHP),this.portraitDisplayTween=e.tweens.create({duration:300,x:850,targets:this.secondHero.portrait}),this.attackerRoundDamage=p(e,230,100,"",{fontSize:"18px"}),this.attackerRoundCount=p(e,this.attackerRoundDamage.getRightCenter().x+1,this.attackerRoundDamage.getTopCenter().y,"×2",{fontSize:"18px"}),this.defenderRoundDamage=p(e,this.attackerRoundDamage.getRightCenter().x+240,this.attackerRoundDamage.getTopCenter().y,"-",{fontSize:"18px"}),this.defenderRoundCount=p(e,this.defenderRoundDamage.getRightCenter().x,this.defenderRoundDamage.getTopCenter().y,"",{fontSize:"18px"});const r=new a.GameObjects.Image(e,this.attackerRoundDamage.getBottomLeft().x+10,this.attackerRoundDamage.getBottomLeft().y,"stat-line").setOrigin(.5,0).setScale(.2,.5);this.add(r),this.add(new a.GameObjects.Image(e,r.x+240,r.y,"stat-line").setOrigin(.5,0).setScale(.2,.5)),this.add(this.defenderRoundDamage),this.add(this.defenderRoundCount),this.add(this.attackerRoundCount),this.add(this.attackerRoundDamage)}setForecastData(e){var t;this.koTween&&(null===(t=this.koTween.targets[0])||void 0===t||t.setAlpha(1),this.koTween.stop()),this.remove(this.attackerStatMods.getChildren(),!0),this.remove(this.defenderStatMods.getChildren(),!0),this.attackerStatMods.clear(),this.defenderStatMods.clear();const{attacker:s,defender:a}=e,i=s.statChanges,l=a.statChanges;this.attackerRoundDamage.setText(s.damage.toString()),this.attackerRoundDamage.setColor(s.effective?d:r),this.attackerRoundCount.setText(s.turns>=2?"×"+s.turns.toString():"").setX(this.attackerRoundDamage.getRightCenter().x);let h=this.firstSideBg.getCenter().x-20;for(let e in i)if(i[e]){const t=i[e],s=p(this.scene,h,140,`${t>0?"+":""}${t}`,{color:t<0?n:o}).setOrigin(1,0),a=p(this.scene,s.getLeftCenter().x-50,140,D(e));this.attackerStatMods.add(a),this.attackerStatMods.add(s),this.add(s),this.add(a),h=a.getLeftCenter().x-5}let c=this.firstSideBg.getCenter().x+20;for(let e in l)if(l[e]){const t=p(this.scene,c,140,D(e)),s=l[e];this.defenderStatMods.add(t);const a=p(this.scene,t.getRightCenter().x+20,140,`${s>0?"+":""}${s}`,{color:s<0?n:o});this.defenderStatMods.add(a),this.add(a),this.add(t),c=a.getRightCenter().x+5}this.firstHero.nameplate.weaponIcon.setTexture("weapons",s.hero.getInternalHero().getWeapon().color+"-"+s.hero.getInternalHero().getWeapon().type),this.firstHero.nameplate.heroName.setText(s.hero.getInternalHero().name),this.secondHero.nameplate.weaponIcon.setTexture("weapons",a.hero.getInternalHero().getWeapon().color+"-"+a.hero.getInternalHero().getWeapon().type),this.secondHero.nameplate.heroName.setText(a.hero.getInternalHero().name);const f=s.hero.getInternalHero().stats.hp/s.hero.getInternalHero().maxHP<.5?"-damage":"",u=a.hero.getInternalHero().stats.hp/a.hero.getInternalHero().maxHP<.5?"-damage":"";this.firstHero.portrait.setTexture(s.hero.getInternalHero().name,"portrait"+f),this.secondHero.portrait.setTexture(a.hero.getInternalHero().name,"portrait"+u),this.secondHero.portrait.x=1100,this.portraitDisplayTween.play();const w=s.startHP<10?m:g,y=s.endHP<10?m:g,b=a.startHP<10?m:g,k=a.endHP<10?m:g;let S;this.firstHero.previousHP.destroy(),this.firstHero.predictedHP.destroy(),this.firstHero.previousHP=w({scene:this.scene,x:this.firstHero.previousHP.x,y:this.firstHero.previousHP.y,content:s.startHP,style:{fontSize:"36px"}}).setOrigin(1,0),0===s.endHP&&(S=this.firstHero.portrait),0===a.endHP&&(S=this.secondHero.portrait),this.koTween=this.scene.tweens.create({duration:1e3,loop:-1,targets:S,yoyo:!0,alpha:.5}),this.koTween.play(),this.firstHero.predictedHP=y({scene:this.scene,x:this.firstHero.predictedHP.x,y:this.firstHero.predictedHP.y,content:s.endHP,style:{fontSize:"36px"}}).setOrigin(1,0),this.add(this.firstHero.predictedHP),this.add(this.firstHero.previousHP),this.secondHero.previousHP.destroy(),this.secondHero.predictedHP.destroy(),this.secondHero.previousHP=b({scene:this.scene,x:this.secondHero.previousHP.x,y:this.secondHero.previousHP.y,content:a.startHP,style:{fontSize:"36px"}}).setOrigin(1,0),this.secondHero.predictedHP=k({scene:this.scene,x:this.secondHero.predictedHP.x,y:this.secondHero.predictedHP.y,content:a.endHP,style:{fontSize:"36px"}}),this.add(this.secondHero.predictedHP),this.add(this.secondHero.previousHP),this.defenderRoundDamage.setText(e.defender.damage&&e.defender.turns?e.defender.damage.toString():"-"),this.defenderRoundCount.setText(a.turns>=2?"×"+a.turns.toString():"").setX(this.defenderRoundDamage.getRightCenter().x+2)}runKOTween(e){this.koTween&&this.koTween.destroy(),this.koTween=this.scene.tweens.create({duration:500,loop:-1,targets:[e],yoyo:!0,alpha:.6})}updatePortraits(e,t){e<.5&&!this.firstHero.portrait.frame.name.includes("damage")&&this.scene.tweens.create({targets:[this.firstHero.portrait],alpha:0,duration:100,yoyo:!0,onYoyo:()=>{this.firstHero.portrait.setFrame("portrait-damage")}}).play(),t<.5&&!this.secondHero.portrait.frame.name.includes("damage")&&this.scene.tweens.create({targets:[this.secondHero.portrait],alpha:0,duration:100,yoyo:!0,onYoyo:()=>{this.secondHero.portrait.setFrame("portrait-damage")}}).play()}}function D(e){return e[0].toUpperCase()+e.substring(1,e.length)}const T=C;var B=s(944),P=s.n(B);const R=new(P().Hero)({name:"Ryoma",weaponColor:"red",weaponType:"sword",lv1Stats:{hp:17,atk:8,spd:11,def:6,res:5},growthRates:{hp:55,atk:60,spd:65,def:50,res:35},movementType:"flier"}),A=new(P().Hero)({name:"Lyn",lv1Stats:{hp:16,atk:7,spd:9,def:5,res:6},growthRates:{hp:45,atk:60,spd:60,def:30,res:50},weaponColor:"colorless",weaponType:"bow",movementType:"cavalry"}),O=new(P().Hero)({name:"Ike",lv1Stats:{hp:19,atk:10,spd:6,def:9,res:10},growthRates:{hp:50,atk:60,spd:55,def:60,res:40},weaponColor:"red",weaponType:"sword",movementType:"infantry"}),j=new(P().Hero)({name:"Corrin",lv1Stats:{hp:16,atk:7,spd:7,def:5,res:5},growthRates:{hp:60,atk:65,spd:65,def:60,res:45},weaponColor:"blue",weaponType:"dragonstone",movementType:"infantry"}),N=new(P().Hero)({name:"Lucina",movementType:"infantry",weaponColor:"blue",weaponType:"lance",lv1Stats:{hp:17,atk:8,spd:10,def:8,res:4},growthRates:{hp:55,atk:60,spd:60,def:45,res:35},bane:"atk",boon:"def"}),M=new(P().Hero)({name:"Robin",weaponColor:"colorless",weaponType:"dragonstone",lv1Stats:{hp:16,atk:8,spd:9,def:8,res:6},growthRates:{hp:55,atk:55,spd:60,def:50,res:45},movementType:"flier"}),G=new(P().Hero)({name:"Ephraim",weaponColor:"green",weaponType:"axe",lv1Stats:{hp:22,atk:10,spd:5,def:11,res:7},growthRates:{hp:55,atk:65,spd:50,def:60,res:45},movementType:"armored"}),F=new(P().Hero)({name:"Hector",weaponColor:"green",weaponType:"axe",lv1Stats:{hp:23,atk:10,spd:6,def:12,res:4},growthRates:{hp:55,atk:70,spd:40,def:60,res:50},movementType:"armored"}),W=new(P().Weapon);W.setName("Mulagir").setMight(14).setType("bow").setColor("colorless").setEffectiveness("flier"),W.onEquip=e=>{e.raiseStat("spd",3)},W.onBeforeCombat=({enemy:e,wielder:t})=>{"tome"===e.getWeapon().type&&e.lowerCursor("mapBuff",1),"flier"===e.movementType&&t.raiseCursor("effectiveness",1)},W.setDescription("Effective against flying foes. Grants Spd+3. Neutralizes magic foe's bonuses (from skills like Fortify, Rally, etc.) during combat.");const z=new(P().Weapon);z.setType("sword").setColor("red").setMight(19).setName("Ragnell"),z.setDescription("Unit can counterattack regardless of range."),z.onDefense=e=>{e.wielder.raiseCursor("counterattack",1)};const E=new(P().Weapon)({name:"Draconic Rage",might:16,range:1,type:"dragonstone",color:"blue",description:"Accelerates Special trigger (cooldown count-1). If the number of allies within 2 spaces (excluding unit) > the number of foes within 2 spaces (excluding target), grants Atk/Spd+5 during combat. If foe's Range = 2, calculates damage using the lower of foe's Def or Res."});E.onBeforeCombat=({wielder:e,enemy:t})=>{let s=0,a=0;for(let t of e.allies)e.getDistance(t)<=2&&s++;for(let s of t.allies)s.getDistance(e)<=2&&a++;s>a&&e.setBattleMods({atk:5,spd:5}),2===t.getWeapon().range&&e.raiseCursor("lowerOfDefAndRes",1)};const q=new(P().Weapon)({name:"Expiration",might:16,range:1,type:"dragonstone",color:"colorless",description:"Unit can counterattack regardless of foe's range. If foe's Range = 2, calculates damage using the lower of foe's Def or Res."});q.onDefense=({wielder:e})=>{e.raiseCursor("counterattack",1)},q.onBeforeCombat=({wielder:e,enemy:t})=>{2===t.getWeapon().range&&e.raiseCursor("lowerOfDefAndRes",1)};const $=new(P().Weapon)({name:"Geirskögul",type:"lance",color:"blue",might:16,range:1,description:"Grants Def+3. If allies within 2 spaces use sword, lance, axe, bow, dagger, or beast damage, grants Atk/Spd+3 to those allies during combat."});$.onEquip=e=>{e.raiseStat("def",3)},$.onBeforeAllyCombat=({ally:e,wielder:t})=>{e.getDistance(t)<=2&&["sword","lance","axe","bow","dagger","beast"].includes(e.getWeapon().type)&&e.setBattleMods({atk:3,spd:3})};const V=new(P().Weapon)({name:"Thunder Armads",type:"axe",color:"green",might:16,range:1,description:"Grants Def+3. If unit is within 3 spaces of an ally, inflicts Atk/Def-5 on foe during combat and foe cannot make a follow-up attack."});V.onEquip=e=>{e.raiseStat("def",3)},V.onBeforeCombat=({wielder:e,enemy:t})=>{let s=0,a=0,i=!1;for(let a of e.allies)e.getDistance(a)<=2&&s++,e.getDistance(a)<=3&&!i&&(t.setBattleMods({atk:-5,def:-5}),i=!0,t.lowerCursor("followup",1));for(let t of e.enemies)e.getDistance(t)<=2&&a++;s>a&&t.lowerCursor("followup",1)};const L=new(P().Weapon);L.setName("Garm").setType("axe").setColor("green").setMight(16).setRange(1).setDescription("Grants Atk+3. If a bonus granted by a skill like Rally or Hone and/or 1 extra space of movement granted by a skill like Armor March or Armored Boots is active, unit makes a guaranteed follow-up attack."),L.onEquip=e=>{e.raiseStat("atk",3)},L.onBeforeCombat=({wielder:e})=>{e.statuses.length&&e.raiseCursor("followup",1)};const _=new(P().Weapon)({range:1,might:16,type:"sword",color:"red",name:"Raijinto",description:"Unit can counterattack regardless of range."});_.onDefense=({wielder:e})=>{e.raiseCursor("counterattack",1)};const X=new(P().PassiveSkill);X.setName("Distant Counter"),X.setSlot("A"),X.onDefense=({wielder:e})=>{e.raiseCursor("counterattack",1)},X.setDescription("Unit can counterattack regardless of foe's range.");const U=new(P().PassiveSkill);U.setName("Vengeful Fighter 3"),U.setSlot("B"),U.setDescription("If unit's HP ≥ 50% and foe initiates combat, grants Special cooldown charge +1 per unit's attack, and unit makes a guaranteed follow-up attack. (Does not stack.)"),U.onDefense=({wielder:e})=>{e.stats.hp/e.maxHP>=.5&&e.raiseCursor("followup",1)};const K=new(P().PassiveSkill);K.setName("Dragonskin"),K.setSlot("A"),K.setDescription('Neutralizes "effective against flying" bonuses. If foe initiates combat, grants Def/Res+4 during combat.'),K.onBeforeCombat=({enemy:e})=>{e.getWeapon().effectiveAgainst.includes("flier")&&e.lowerCursor("effectiveness",1)},K.onDefense=({wielder:e})=>{e.setBattleMods({def:4,res:4})};const Y=(new(P().PassiveSkill)).setName("Sturdy Blow 2").setSlot("A").setDescription("If unit initiates combat, grants Atk/Def+4 during combat.");Y.onInitiate=({wielder:e})=>{e.setBattleMods({atk:4,def:4})};const J=(new(P().PassiveSkill)).setName("Drive Spd 2").setSlot("C").setDescription("Grants Spd+3 to allies within 2 spaces during combat.");J.onBeforeAllyCombat=({ally:e,wielder:t})=>{t.getDistance(e)<=2&&e.setBattleMods({spd:3})};const Q=(new(P().PassiveSkill)).setDescription("If unit is adjacent to an ally, grants Atk/Res+5 during combat.");Q.setName("Atk/Res Bond 3").setSlot("S"),Q.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(1===e.getDistance(t))return void e.setBattleMods({atk:5,res:5})};const Z=new(P().PassiveSkill);Z.setName("Atk/Def Bond 3").setSlot("A").setDescription("If unit is adjacent to an ally, grants Atk/Def+5 during combat."),Z.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(1===e.getDistance(t))return void e.setBattleMods({atk:5,def:5})};const ee=(new(P().PassiveSkill)).setName("Atk/Res Form 3").setSlot("S").setDescription("If unit is within 2 spaces of an ally, grants Atk/Res+X to unit during combat (X = 2 × number of allies within 2 spaces, + 1; max 7)."),te=(new(P().PassiveSkill)).setName("Sacae's Blessing").setSlot("B");te.onInitiate=({enemy:e})=>{["sword","axe","lance"].includes(e.getWeapon().type)&&e.lowerCursor("counterattack",1)},ee.onBeforeCombat=({wielder:e})=>{let t=0;for(let s of e.allies)e.getDistance(s)<=2&&t++;const s=Math.min(2*t+1,7);e.setBattleMods({atk:s,res:s})},Q.slot="A";const se=(new(P().PassiveSkill)).setName("Spd/Res Rein 3").setSlot("C").setDescription("Inflicts Spd/Res-4 on foes within 2 spaces during combat.");se.onBeforeAllyCombat=({wielder:e,enemy:t})=>{e.getDistance(t)<=2&&t.setBattleMods({spd:-4,res:-4})},se.onBeforeCombat=({enemy:e})=>{e.setBattleMods({spd:-4,res:-4})};const ae=(new(P().PassiveSkill)).setName("Kestrel Stance 2").setSlot("A").setDescription("If foe initiates combat, grants Atk/Spd+4 during combat.");ae.onDefense=({wielder:e})=>{e.setBattleMods({atk:4,spd:4})};const ie=(new(P().PassiveSkill)).setName("Atk/Spd Rein 3").setSlot("C").setDescription("Inflicts Atk/Spd-4 on foes within 2 spaces during combat.");ie.onBeforeAllyCombat=({wielder:e,enemy:t})=>{e.getDistance(t)<=2&&t.setBattleMods({atk:-4,spd:-4})},ie.onBeforeCombat=({enemy:e})=>{e.setBattleMods({atk:-4,spd:-4})};const oe=(new(P().PassiveSkill)).setName("Warding Breath").setSlot("A");oe.onDefense=({wielder:e})=>{e.setBattleMods({res:4})},oe.setDescription("If foe initiates combat, grants Res+4 during combat and Special cooldown charge +1 per attack. (Only highest value applied. Does not stack.)");const ne=(new(P().PassiveSkill)).setName("Joint Drive Res").setSlot("C");ne.onBeforeAllyCombat=({ally:e,wielder:t})=>{t.getDistance(e)<=2&&e.setBattleMods({res:4})},ne.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(e.getDistance(t)<=2)return void e.setBattleMods({res:4})},ne.setDescription("Grants Res+4 to allies within 2 spaces during combat. If unit is within 2 spaces of an ally, grants Res+4 to unit during combat.");const re=(new(P().PassiveSkill)).setName("Seal Atk/Def 2").setSlot("B");re.onAfterCombat=({enemy:e,wielder:t})=>(e.allies.filter((t=>t.getDistance(e)<=2)),[]),re.setDescription("Inflicts Atk/Def-5 on foe through its next action after combat.");const le=(new(P().PassiveSkill)).setName("Bushido II").setSlot("B");le.onBeforeCombat=({wielder:e,enemy:t,damage:s})=>{t.raiseCursor("damageIncrease",7),t.getWeapon().effectiveAgainst.includes("flier")&&t.lowerCursor("effectiveness",1),e.getBattleStats().spd>t.getBattleStats().spd&&Math.min(40,4*(e.getBattleStats().spd-t.getBattleStats().spd))},le.setDescription("Neutralizes \"effective against flying\" bonuses. Deals +7 damage. If unit's Spd > foe's Spd, reduces damage from attacks during combat and from area-of-effect Specials (excluding Røkkr area-of-effect Specials) by percentage = difference between stats × 4 (max 40%).");const de=(new(P().PassiveSkill)).setSlot("A").setName("Close Def 3").setDescription("If foe initiates combat and uses sword, lance, axe, dragonstone, or beast damage, grants Def/Res+6 during combat.");de.onDefense=({wielder:e,enemy:t})=>{1===t.getWeapon().range&&e.setBattleMods({def:6,res:6})};const he=(new(P().PassiveSkill)).setName("Swift Sparrow 3").setSlot("A").setDescription("If unit initiates combat, grants Atk+6, Spd+7 during combat.");he.onInitiate=({wielder:e})=>{e.setBattleMods({atk:6,spd:6})};const ce=(new(P().PassiveSkill)).setName("Ostia's Pulse II").setSlot("C").setDescription("At start of turn, grants Def/Res+6 to unit and allies for one turn, and also, if any unit or ally's Special cooldown count is at its maximum value, grants them Special cooldown count-1. All effects granted only if the number of that unit or ally's movement type on the current team is ≤ 2.");ce.onTurnStart=({wielder:e})=>{const t=[];let s={armored:1,infantry:0,flier:0,cavalry:0};const a=[e];for(let t of e.allies)1===e.getDistance(t)&&a.push(t),s[t.movementType]++;for(let e of a)s[e.movementType]<=2&&t.push({targetHeroId:e.id,appliedEffect:{stats:{def:6,res:6}}});return t};const pe=(new(P().PassiveSkill)).setName("Windsweep 3").setSlot("B").setDescription("If unit initiates combat, unit cannot make a follow-up attack. If unit's Spd > foe's Spd and foe uses sword, lance, axe, bow, dagger, or beast damage, foe cannot counterattack.");pe.onInitiate=({wielder:e,enemy:t})=>{e.lowerCursor("followup",1),["sword","lance","axe","dagger","bow","beast"].includes(t.getWeapon().type)&&t.lowerCursor("counterattack",1)},pe.setDescription("If unit initiates combat, unit cannot make a follow-up attack. If unit's Spd > foe's Spd and foe uses sword, lance, axe, bow, dagger, or beast damage, foe cannot counterattack.");const me=(new(P().PassiveSkill)).setName("Atk/Spd Bond 4").setSlot("S").setDescription("If unit is adjacent to an ally, grants Atk/Spd+7 to unit and neutralizes unit's penalties to Atk/Spd during combat.");me.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(1===e.getDistance(t)){const t={atk:7,spd:7};for(let s in e.mapMods)e.mapMods[s]<0&&(t[s]+=-e.mapMods[s],e.mapMods[s]=0);return void e.setBattleMods(t)}};const ge=(new(P().PassiveSkill)).setName("Null Follow-Up 3").setSlot("B").setDescription("Neutralizes effects that guarantee foe's follow-up attacks and effects that prevent unit's follow-up attacks during combat.");ge.onBeforeCombat=({wielder:e})=>{e.raiseCursor("followup",1)};const fe=(new(P().PassiveSkill)).setName("Swordbreaker 3").setSlot("B").setDescription("If unit's HP ≥ 50% in combat against a sword foe, unit makes a guaranteed follow-up attack and foe cannot make a follow-up attack.");fe.onBeforeCombat=({wielder:e,enemy:t})=>{"sword"===t.getWeapon().type&&(e.raiseCursor("followup",1),t.lowerCursor("followup",1))};const ue=(new(P().PassiveSkill)).setName("Atk/Def Solo 4").setSlot("S").setDescription("If unit is not adjacent to an ally, grants Atk/Def+7 during combat.");ue.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(1===e.getDistance(t))return;e.setBattleMods({atk:7,def:7})};const we=(new(P().PassiveSkill)).setName("Spd Smoke 3").setSlot("S").setDescription("Inflicts Spd-7 on foes within 2 spaces of target through their next actions after combat."),ye=(new(P().PassiveSkill)).setName("Atk Smoke 3").setSlot("C").setDescription("Inflicts Atk-7 on foes within 2 spaces of target through their next actions after combat."),be=(new(P().PassiveSkill)).setName("Res Smoke 3").setSlot("S").setDescription("Inflicts Res-7 on foes within 2 spaces of target through their next actions after combat."),ke=(new(P().PassiveSkill)).setName("Hone Spd 2").setSlot("C").setDescription("At start of turn, grants Spd+4 to adjacent allies for 1 turn."),Se=(new(P().PassiveSkill)).setName("Armor March 3").setSlot("S").setDescription("At start of turn, if unit is adjacent to an armored ally, unit and adjacent armored allies can move 1 extra space. (That turn only. Does not stack.)"),xe=(new(P().PassiveSkill)).setName("Special Fighter 3").setSlot("B").setDescription("At start of combat, if unit's HP ≥ 50%, grants Special cooldown charge +1 to unit and inflicts Special cooldown charge -1 on foe per attack. (Only highest value applied. Does not stack.)");ye.onAfterCombat=({enemy:e})=>{let t=[];for(let s of e.allies)e.getDistance(s)<=2&&t.push({targetHeroId:s.id,appliedEffect:{stats:{atk:-7}}});return t},be.onAfterCombat=({enemy:e})=>{let t=[];for(let s of e.allies)e.getDistance(s)<=2&&t.push({targetHeroId:s.id,appliedEffect:{stats:{res:-7}}});return t},we.onAfterCombat=({enemy:e})=>{let t=[];for(let s of e.allies)e.getDistance(s)<=2&&t.push({targetHeroId:s.id,appliedEffect:{stats:{spd:-7}}});return t},ke.onTurnStart=({wielder:e})=>{let t=[];for(let s of e.allies)1===e.getDistance(s)&&t.push({targetHeroId:s.id,appliedEffect:{stats:{spd:4}}});return t},F.equipSkill(X),F.equipSkill(U),F.setWeapon(V),F.equipSkill(ce),F.equipSkill(Se),Se.slot="C",j.setWeapon(E),j.equipSkill(Z),j.equipSkill(ee),j.equipSkill(ge),j.equipSkill(ke),N.setWeapon($),N.equipSkill(Y),N.equipSkill(me),N.equipSkill(J),N.equipSkill(pe),G.equipSkill(de),G.setWeapon(L),G.equipSkill(ue),G.equipSkill(Se),G.equipSkill(xe),M.equipSkill(se),M.setWeapon(q),M.equipSkill(K),M.equipSkill(be),M.equipSkill(fe),A.setWeapon(W),A.equipSkill(he),A.equipSkill(te),A.equipSkill(ye),A.equipSkill(we),R.setWeapon(_),R.equipSkill(ae),R.equipSkill(ie),R.equipSkill(le),R.equipSkill(we),O.setWeapon(z),O.equipSkill(ne),O.equipSkill(oe),O.equipSkill(re),O.equipSkill(ee);const ve=new class{constructor(){this.team1=[],this.team2=[],this.map={};for(let e=1;e<9;e++)this.map[e]=Array.from({length:6}).fill(null)}resetEffects(e){for(let{hero:t}of this[e])t.mapMods={atk:0,spd:0,res:0,def:0},t.statuses=[]}getDistance(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}moveHero(e,t){const s=e.coordinates;this.map[s.y][s.x]=null,e.coordinates=t,this.map[t.y][t.x]=e}killHero(e){for(let t of e.allies)t.allies=t.allies.filter((({id:t})=>t!==e.id));for(let t of e.enemies)t.enemies=t.enemies.filter((({id:t})=>t!==e.id));this.team1=this.team1.filter((({hero:t})=>t.id!==e.id)),this.team2=this.team2.filter((({hero:t})=>t.id!==e.id))}addHero(e,t,s){e.coordinates=s,this[t].push(Object.assign({hero:e},s))}startCombat(e,t){return new(P().Combat)({attacker:e,defender:t}).createCombat()}setAlliesAndEnemies(){for(let e=0;e<this.team1.length;e++){for(let t=e+1;t<this.team1.length;t++)this.team1[e].hero.setAlly(this.team1[t].hero),this.team1[t].hero.setAlly(this.team1[e].hero);for(let t=0;t<this.team2.length;t++)this.team1[e].hero.setEnemy(this.team2[t].hero)}for(let e=0;e<this.team2.length;e++){for(let t=e+1;t<this.team2.length;t++)this.team2[e].hero.setAlly(this.team2[t].hero),this.team2[t].hero.setAlly(this.team2[e].hero);for(let t=0;t<this.team2.length;t++)this.team2[e].hero.setEnemy(this.team1[t].hero)}this.effectRunner=new(P().MapEffectRunner)(this.team1.map((({hero:e})=>e)),this.team2.map((({hero:e})=>e)))}getTurnStartEffects(e){return this.effectRunner.runTurnStartEffects(e)}getPostCombatEffects(e,t,s){return this.effectRunner.runAfterCombatEffects({hero:e,enemy:t,combatOutcome:s})}};ve.addHero(F,"team1",{x:4,y:1}),ve.addHero(N,"team1",{y:1,x:2}),ve.addHero(R,"team1",{x:3,y:1}),ve.addHero(M,"team1",{x:5,y:1}),ve.addHero(O,"team2",{y:7,x:6}),ve.addHero(j,"team2",{y:7,x:4}),ve.addHero(G,"team2",{x:3,y:7}),ve.addHero(A,"team2",{y:7,x:5}),ve.setAlliesAndEnemies();const He=ve;class Ie extends a.GameObjects.Container{constructor(e,t,s){super(e,t,s);const i=new a.GameObjects.Image(e,0,0,"interaction-bubble"),o=i.getCenter(),n=new a.GameObjects.Image(e,o.x,o.y-5,"interaction-attack");this.add([i,n])}}const Ce=Ie,De=125;function Te(e,t){return{x:e*De-63,y:t*De+120}}function Be(e,t){return{x:Math.round((63+e)/De),y:Math.round((t-120)/De)}}class Pe extends Phaser.Scene{constructor(){super({key:"MainScene"}),this.map=[],this.walkCoords=[],this.attackCoords=[],this.displayRange=!1,this.heroes=[],this.team1=[],this.team2=[],this.heroesWhoMoved=[],this.turn="team1",this.rng=new Phaser.Math.RandomDataGenerator,this.terrain=[["wall","floor","floor","floor","floor","floor"],["wall","floor","floor","floor","void","floor"],["floor","floor","floor","floor","floor","floor"],["floor","floor","floor","floor","floor","floor"],["floor","wall","floor","tree","floor","tree"],["floor","tree","floor","floor","floor","wall"],["floor","floor","floor","floor","floor","floor"],["tree","void","void","void","void","tree"]],this.updateDelta=0;for(let e=0;e<9;e++){const e=Array.from({length:6}).fill(null);this.map.push(e)}}fillTiles(e,t,s=1){for(let a of e)this.getTile(a).setFillStyle(t,s)}clearTiles(e){for(let t of e)this.getTile(t).setFillStyle(0)}endAction(e){e.off("drag"),e.off("dragover"),e.off("dragenter"),e.off("dragleave"),e.off("dragend"),e.off("pointerdown"),this.input.setDraggable(e,!1),e.disableInteractive(),e.image.setTint(7829367),this.heroesWhoMoved.push(e),this.displayRange=!1,this.children.remove(this.children.getByName("movement-"+e.getInternalHero().name)),this.highlightedHero=null}buildArrowPath(e,t,s){let a=e,i=new Map,o=this.getDistance(e,t);for(i.set(`${e.x}-${e.y}`,e),i.set(`${t.x}-${t.y}`,t);o;){const e=Ae(a).filter((e=>this.heroCanReachTile(s,e)&&this.getDistance(e,t)<o));a=e[0],o=this.getDistance(t,e[0]);const{x:n,y:r}=a;i.set(`${n}-${r}`,a)}return Array.from(i.values()).sort(((t,s)=>this.getDistance(t,e)-this.getDistance(s,e)))}killHero(e){this[e.team]=this[e.team].filter((({name:t})=>t!==e.name)),this.heroes=this.heroes.filter((({name:t})=>t!==e.name));const{x:t,y:s}=Be(e.x,e.y);this.map[s][t]=null,this.children.remove(e),He.killHero(e.getInternalHero()),e.destroy(),e=null}setTurn(e){this.movementAllowedImages.clear();const t="team1"===e?"team2":"team1";this.turn=e,this.heroesWhoMoved=[],He.resetEffects(e);const s=He.getTurnStartEffects(e);for(let t of this[e]){t.statuses=[],t.setInteractive();const{x:e,y:s}=Be(t.x,t.y);let i={x:e,y:s};this.input.setDraggable(t,!0);const o=new Phaser.GameObjects.Image(this,t.x,t.y,"movement-allowed").setName(`movement-${t.getInternalHero().name}`).setDepth(0);this.add.existing(o);const n=this.getTile(i.x+"-"+i.y);let r;o.setDisplaySize(n.width,n.height),this.movementAllowedImages.add(o);let l="",d=0;t.off("pointerdown"),t.on("drag",((e,s,a)=>{t.x=s,t.y=a})),t.on("pointerdown",(({event:{timeStamp:e}})=>{if(e-d<=300)return void this.endAction(t);d=e;const s=Be(t.x,t.y);this.movementAllowedImages.setVisible(!1);const a=this.children.getByName(`movement-${t.getInternalHero().name}`);a.setVisible(!0),r=this.add.image(a.x,a.y,"rosary").setDisplaySize(a.width,a.height).setScale(1.35).setName("arrow"),this.movementAllowedTween.pause(),this.sound.play("enabled-unit");const i=this.rng.integerInRange(1,3);l&&this.sound.stopByKey(l);const o=t.getInternalHero().name+" quotes";this.sound.playAudioSprite(t.getInternalHero().name+" quotes",i.toString(),{volume:.2}),l=o,this.unitInfosBanner.setVisible(!0).setHero(t),this.displayRanges(s,t.getMovementRange(),t.getWeaponRange())}));let h="";const c=new a.GameObjects.Image(this,0,0,"end-arrow").setName("end-arrow");this.movementArrows.add(c);let m="";t.on("dragenter",((e,s)=>{var a,o;if(s.name!==m&&(m=s.name),this.walkCoords.includes(s.name)&&s.name!==h){this.combatForecast.setVisible(!1),this.unitInfosBanner.setVisible(!0),this.sound.play("hover");const e=s.name.split("-").map(Number),a=this.buildArrowPath(Object.assign({},i),{x:e[0],y:e[1]},t);r.setTexture("rosary"),t.getInternalHero().coordinates=a[a.length-1],this.movementArrows.clear(!0);for(let e=0;e<a.length;e++){const t=a[e-1],s=a[e];if(e&&this.add.existing(c),t&&a[e-2]){const i=Oe(a[e-2],s),o=this.getTile(t.x+"-"+t.y);var n=i.x?i.y?`path-${i.y}-${i.x}`:"horizontal":"vertical";const r=new Phaser.GameObjects.Image(this,o.x,o.y,n);this.add.existing(r),this.movementArrows.add(r)}if(1===e){const e=Oe(t,s),a="up"===e.y?180:"down"===e.y?0:null,i="left"===e.x?90:"right"===e.x?-90:null,o=null!=a?a:i;r.setTexture("rosary-arrow"),r.setRotation(o*Math.PI/180)}if(1===a.length)this.children.remove(this.children.getByName("end-arrow"));else if(e===a.length-1&&e){const e=a[a.length-1],s=this.getTile(e.x+"-"+e.y);c.x=s.x,c.y=s.y;const i=Oe(t,e),o="left"===i.x?180:"right"===i.x?0:null,n="up"===i.y?-90:"down"===i.y?90:null,r=null!=o?o:n;c.setRotation(r*Math.PI/180)}}h=s.name,this.children.getByName(`movement-${t.getInternalHero().name}`).x=s.x,this.children.getByName(`movement-${t.getInternalHero().name}`).y=s.y,this.interactionIndicator.setVisible(!1)}else if(this.attackCoords.includes(s.name)){const[e,i]=s.name.split("-");if((null!==(o=null===(a=this.map[+i][+e])||void 0===a?void 0:a.team)&&void 0!==o?o:t.team)!==t.team){const s=this.map[+i][+e];this.unitInfosBanner.setVisible(!1),this.interactionIndicator.x=s.image.getCenter().x+s.x,this.interactionIndicator.y=s.image.getTopCenter().y-30+s.y,this.interactionIndicator.setVisible(!0),this.interactionIndicatorTween&&this.interactionIndicatorTween.stop(),this.interactionIndicatorTween=this.tweens.create({y:this.interactionIndicator.y-10,loop:-1,yoyo:!0,targets:this.interactionIndicator,duration:400}),this.interactionIndicatorTween.play();const a=He.startCombat(t.getInternalHero(),s.getInternalHero());this.combatForecast.setForecastData({attacker:{hero:t,startHP:t.getInternalHero().stats.hp,endHP:a.atkRemainingHP,statChanges:a.atkChanges,turns:a.atkTurns,effective:a.atkEffective,damage:a.atkDamage},defender:{hero:s,startHP:s.getInternalHero().stats.hp,endHP:a.defRemainingHP,statChanges:a.defChanges,effective:a.defEffective,turns:a.defTurns,damage:a.defDamage}}),this.combatForecast.setVisible(!0)}}})),t.off("dragend"),t.on("dragend",(({upX:e,upY:s})=>{const{x:a,y:o}=Be(e,s);if(this.movementArrows.setVisible(!1),this.children.remove(this.children.getByName("arrow")),this.children.remove(this.children.getByName("end-arrow")),this.interactionIndicator.setVisible(!1),!this.walkCoords.includes(a+"-"+o)||this.map[o][a]||i.x===a&&i.y===o)if(this.attackCoords.includes(a+"-"+o)&&this.map[o][a]&&this.map[o][a].team!==t.team){const e=this.getTilesInShallowRange({x:a,y:o},t.getWeaponRange()),s=[`${t.getInternalHero().coordinates.x}-${t.getInternalHero().coordinates.y}`],n=je(Array.from(e.keys()),this.walkCoords);console.log({overlap:n});const[r]=n.length?n:s,[l,d]=r.split("-");this.moveHero(t,i,{x:+l,y:+d}),i.x=+l,this.movementAllowedImages.setVisible(!1),i.y=+d;const h=this.map[o][a],c=He.startCombat(t.getInternalHero(),h.getInternalHero()),m=this.tweens.timeline();m.on("complete",(()=>{this.clearTiles([...this.walkCoords,...this.attackCoords]);const e=[t,h].find((e=>0===e.getInternalHero().stats.hp));e?this.tweens.add({targets:e,alpha:0,delay:700,onStart:()=>{this.sound.play("ko",{volume:.4})},onComplete:()=>{this.game.input.enabled=!0,t.getInternalHero().stats.hp&&this.endAction(t),this.children.remove(this.children.getByName("movement-"+e.getInternalHero().name)),this.killHero(e),this.movementAllowedImages.setVisible(!0),this.movementAllowedTween.resume(),this.combatForecast.setVisible(!1)}}):setTimeout((()=>{this.combatForecast.setVisible(!1),this.endAction(t),this.game.input.enabled=!0}),300);const s=He.getPostCombatEffects(t.getInternalHero(),h.getInternalHero(),c);for(let e of s){const t=this.children.getByName(e.targetHeroId);t.statuses.push("debuff"),t.getInternalHero().setMapMods(e.appliedEffect.stats)}}));for(let e=0;e<c.outcome.length;e++){const s=c.outcome[e],a=this.children.getByName(s.defender.id),i=this.children.getByName(s.attacker.id),o=a.image.getCenter(),n=p(this,a.x+o.x,a.y+o.y,s.damage.toString(),{stroke:"#FFFFFF",strokeThickness:5,color:"red",fontSize:"advantage"===s.advantage||s.effective?"32px":"disadvantage"===s.advantage?"25px":"30px"}).setOrigin(.4).setDepth(3);m.add({targets:i,x:"-="+(i.x-a.x)/2,y:"-="+(i.y-a.y)/2,yoyo:!0,duration:150,onStart:()=>{this.sound.play("hit"),a.image.setTintFill(16777215),this.add.existing(n),this.tweens.add({targets:[n],y:a.image.getTopCenter().y+a.y,yoyo:!0,duration:100,onComplete:()=>{a.image.tintFill=!1,setTimeout((()=>{n.destroy()}),500)},onStart:()=>{a.getInternalHero().stats.hp=s.remainingHP;const e=t.getInternalHero().stats.hp/i.getInternalHero().maxHP,o=h.getInternalHero().stats.hp/a.getInternalHero().maxHP;this.combatForecast.updatePortraits(e,o)}})},delay:600})}this.game.input.enabled=!1,m.play()}else{const e=Te(i.x,i.y);this.children.getByName(`movement-${t.getInternalHero().name}`).x=e.x,this.children.getByName(`movement-${t.getInternalHero().name}`).y=e.y,this.tweens.add({targets:t,x:e.x,y:e.y,duration:100}),t.getInternalHero().coordinates=Object.assign({},i)}else{this.combatForecast.setVisible(!1),this.unitInfosBanner.setVisible(!0),this.clearTiles([...this.walkCoords,...this.attackCoords]),this.map[i.y][i.x]=null,i.x=a,i.y=o,this.map[i.y][i.x]=t;const e=Te(a,o);t.x=e.x,t.y=e.y,He.moveHero(t.getInternalHero(),{x:a,y:o}),this.movementArrows.setVisible(!1),this.movementArrows.clear(!0),this.movementAllowedImages.setVisible(!0),this.movementAllowedTween.resume(),this.children.getByName(`movement-${t.getInternalHero().name}`).setVisible(!1),this.sound.play("confirm",{volume:.4}),this.endAction(t),this.children.remove(c)}}))}this.movementAllowedTween=this.tweens.add({targets:this.movementAllowedImages.getChildren(),loop:-1,yoyo:!0,duration:900,alpha:0});for(let e of this[t])e.off("dragover"),e.off("dragend"),this.children.remove(this.children.getByName("movement-"+e.getInternalHero().name)),e.image.clearTint(),this.input.setDraggable(e,!1),e.setInteractive(),e.off("dragstart"),e.off("pointerdown"),e.on("pointerdown",(()=>{this.displayRanges(Be(e.x,e.y),e.getMovementRange(),e.getWeaponRange()),this.sound.play("enabled-unit"),this.highlightedHero=e,this.unitInfosBanner.setVisible(!0).setHero(e)}));for(let e of s){const t=this.children.getByName(e.targetHeroId);t&&e.appliedEffect.stats&&(t.getInternalHero().setMapMods(e.appliedEffect.stats),t.statuses.push("buff"),"team2"===this.turn&&t.on("pointerdown",console.log))}}preload(){this.load.image("map","assets/map.webp"),this.load.image("movement-allowed","assets/movement-allowed.png"),this.load.atlas("weapons","assets/sheets/weapons.webp","assets/sheets/weapons.json"),this.load.atlas("skills","assets/sheets/skills.webp","assets/sheets/skills.json"),this.load.audio("enabled-unit","assets/audio/pointer-tap.mp3"),this.load.audio("disabled-unit","assets/audio/feh disabled unit.mp3"),this.load.audio("hit","assets/audio/hit.mp3"),this.load.audio("ko","assets/audio/ko.mp3"),this.load.image("background","assets/unit-bg-test.png"),this.load.audio("hover","assets/audio/hover on tile.mp3"),this.load.audio("confirm","assets/audio/confirm.mp3"),this.load.image("nameplate","assets/nameplate.png"),this.load.image("end-arrow","assets/end-arrow-fixed.png"),this.load.image("path-down-right","assets/path-down-left.png"),this.load.image("path-down-left","assets/path-down-right.png"),this.load.image("path-up-right","assets/path-up-right.png"),this.load.image("path-up-left","assets/path-up-left.png"),this.load.image("buff","assets/buff-arrow.png"),this.load.image("debuff","assets/debuff-arrow.png"),this.load.image("horizontal","assets/horizontal.png"),this.load.image("vertical","assets/vertical-fixed.png"),this.load.image("unit-bg","assets/unitbg.png"),this.load.image("rosary","assets/rosary-current.png"),this.load.image("rosary-arrow","assets/rosary-arrow.png"),this.load.image("weapon-icon","assets/weapon_icon.png"),this.load.image("interaction-bubble","assets/interaction-bubble.png"),this.load.image("interaction-attack","assets/interaction-attack.png"),this.load.image("weapon-bg","assets/weapon.png"),this.load.image("unit-banner-bg","assets/unit-banner-bg.png"),this.load.image("forecast-bg","assets/forecast-bg.png"),this.load.image("assist-icon","assets/assist-icon.png"),this.load.image("special-icon","assets/special-icon.png"),this.load.audio("bgm","assets/audio/leif's army in search of victory.ogg");for(let e of["Corrin","Hector","Ike","Lucina","Lyn","Robin","Ryoma","Ephraim"])this.load.atlas(e,`assets/battle/${e}.webp`,`assets/battle/${e}.json`),this.load.audioSprite(`${e} quotes`,`assets/audio/quotes/${e}.json`,`assets/audio/quotes/${e}.m4a`);this.load.image("hp plate","assets/hp plate.png"),this.load.image("stat-line","assets/stat-glowing-line.png");for(let e of["A","B","C","S"])this.load.image(e,`assets/${e}.png`)}addHero(e,t){const{x:s,y:a}=Te(e.x,e.y),i=new w(this,s,a,e.hero,t).setInteractive();return this.add.existing(i),this.heroes.push(i),this.map[e.y][e.x]=i,this[t].push(i),i.setDepth(1),i}moveHero(e,t,s){this.map[t.y][t.x]=null,this.map[s.y][s.x]=e;const{x:a,y:i}=Te(s.x,s.y);e.x=a,e.y=i}getNearestToAttackTile(e,t){const s=this.getTilesInShallowRange(t,e.getWeaponRange());return s.size?s:null}create(){this.movementAllowedImages=this.add.group(),this.movementArrows=this.add.group(),this.add.rectangle(0,180,750,1e3,16777215).setOrigin(0);const e=this.add.image(-90,0,"background").setOrigin(0).setTint(996413);e.setDisplaySize(e.displayWidth,180),this.sound.play("bgm",{volume:.1,loop:!0}),this.combatForecast=this.add.existing(new T(this).setVisible(!1)),this.add.image(0,180,"map").setDisplaySize(750,1e3).setOrigin(0,0).setDepth(0);for(let e=1;e<9;e++)for(let t=1;t<7;t++){const{x:s,y:a}=Te(t,e),i=t+"-"+e;this.add.rectangle(s,a,De,De,0).setAlpha(.2).setName(i).setInteractive(void 0,void 0,!0).on("pointerdown",(()=>{const[e,t]=i.split("-");this.map[+t][+e]||(this.clearTiles([...this.walkCoords,...this.attackCoords]),this.displayRange&&this.sound.play("disabled-unit"),this.displayRange=!1,this.movementAllowedImages.setVisible(!0),this.movementAllowedTween.resume(),this.movementArrows.clear(!0))}))}for(let{hero:e,x:t,y:s}of He.team1)this.addHero({x:t,y:s,hero:e},"team1");for(let{hero:e,x:t,y:s}of He.team2)this.addHero({hero:e,x:t,y:s},"team2");this.setTurn("team1"),this.interactionIndicator=this.add.existing(new Ce(this,0,0).setVisible(!1).setDepth(5)),this.interactionIndicatorTween=this.tweens.create({y:"-=40",loop:-1,yoyo:!0,targets:this.interactionIndicator,duration:500}),this.unitInfosBanner=this.add.existing(new v(this).setVisible(!1)).setDepth(1),this.fpsText=p(this,500,120,"",{fontSize:"25px"})}displayRanges(e,t,s){this.displayRange=!0;const a=this.getTilesInRange(e,t);for(let[t,s]of a.entries())this.heroCanReachTile(this.map[e.y][e.x],s)||a.delete(t);const i=function(e,t){const s=new Map;for(let[a,i]of e.entries())t.has(a)||s.set(a,i);for(let[a,i]of t.entries())e.has(a)||s.set(a,i);return s}(a,this.getTilesInRange(e,s,a,!0)),o=Array.from(a.keys()),n=Array.from(i.keys());for(let e of this.walkCoords)o.includes(e)||this.getTile(e).setFillStyle(0);for(let e of this.attackCoords)n.includes(e)||this.getTile(e).setFillStyle(0);this.walkCoords=o,this.attackCoords=n,this.fillTiles(this.walkCoords,255),this.fillTiles(this.attackCoords,16711680)}getTile(e){return this.children.getByName(e)}getTilesInRange(e,t,s,a){let i=s?Array.from(s.values()):[e];const o=s?new Map(s||void 0):new Map,n=this.map[e.y][e.x];for(let e=0;e<t;e++)i=i.map(Ae).flat(),a||(i=i.filter((e=>this.heroCanReachTile(n,e))));for(let e of i)o.has(`${e.x}-${e.y}`)||o.set(`${e.x}-${e.y}`,e);return o}getTilesInShallowRange(e,t){const s=this.getTilesInRange(e,t);return s.forEach(((a,i)=>{this.getDistance(a,e)!==t&&s.delete(i)})),s}getDistance(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}heroCanReachTile(e,t){const s=this.map[t.y][t.x];if(Boolean(s)&&s.team!==e.team)return!1;const a=this.terrain[t.y-1][t.x-1];if("wall"===a)return!1;if("void"===a)return"flier"===e.getInternalHero().movementType;if("flier"===e.getInternalHero().movementType)return!0;const{x:i,y:o}=Be(e.x,e.y);if("cavalry"===e.getInternalHero().movementType&&"trench"===a)return this.getDistance({x:i,y:o},t)<=1;if("tree"===a)switch(e.getInternalHero().movementType){case"cavalry":return!1;case"infantry":return this.getDistance({x:i,y:o},t)<=1;default:return!0}return!0}update(){for(let e of this.heroes)e.toggleStatuses();for(let e of this.heroes)e.update();if(this.heroesWhoMoved.length===this[this.turn].length){const e="team1"===this.turn?"team2":"team1";this.setTurn(e)}}}function Re(e){return e.x>=1&&e.x<=6&&e.y>=1&&e.y<=8}function Ae(e){const{x:t,y:s}=e,a=[e];return a.push({x:t+1,y:s}),a.push({x:t-1,y:s}),a.push({x:t,y:s+1}),a.push({x:t,y:s-1}),a.filter(Re)}function Oe(e,t){const s={y:"",x:""};return e.y!==t.y&&(s.y=e.y<t.y?"down":"up"),e.x!==t.x&&(s.x=e.x<t.x?"right":"left"),s}function je(e,t){const s=[];for(let a of e)t.includes(a)&&s.push(a);for(let a of t)e.includes(a)&&s.push(a);return Array.from(new Set(s))}class Ne extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}create(){this.scene.start("MainScene")}}const Me={type:Phaser.WEBGL,backgroundColor:"#1F5E6D",fps:{forceSetTimeout:!0,target:15,min:15},scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:750,height:1200},scene:[Ne,Pe]};window.addEventListener("load",(()=>{new Phaser.Game(Me)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function a(e){var i=s[e];if(void 0!==i)return i.exports;var o=s[e]={id:e,loaded:!1,exports:{}};return t[e].call(o.exports,o,o.exports,a),o.loaded=!0,o.exports}a.m=t,e=[],a.O=(t,s,i,o)=>{if(!s){var n=1/0;for(h=0;h<e.length;h++){for(var[s,i,o]=e[h],r=!0,l=0;l<s.length;l++)(!1&o||n>=o)&&Object.keys(a.O).every((e=>a.O[e](s[l])))?s.splice(l--,1):(r=!1,o<n&&(n=o));if(r){e.splice(h--,1);var d=i();void 0!==d&&(t=d)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,i,o]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={179:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var i,o,[n,r,l]=s,d=0;if(n.some((t=>0!==e[t]))){for(i in r)a.o(r,i)&&(a.m[i]=r[i]);if(l)var h=l(a)}for(t&&t(s);d<n.length;d++)o=n[d],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(h)},s=self.webpackChunkfire_emblem_heroes=self.webpackChunkfire_emblem_heroes||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),a.O(void 0,[216],(()=>a(181)));var i=a.O(void 0,[216],(()=>a(204)));i=a.O(i)})();