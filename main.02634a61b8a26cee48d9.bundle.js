/*! For license information please see main.02634a61b8a26cee48d9.bundle.js.LICENSE.txt */
(()=>{var e,t={660:(e,t,s)=>{"use strict";var a=s(260);const i="#EAEAA6",o="#F2C42A",n="#CA384D";function r(e,t,s,a,i){return new Phaser.GameObjects.Text(e,t,s,a.toString(),Object.assign({fontFamily:"'FEH'",stroke:"black",strokeThickness:2},i))}function h(e){const{text:t,gradient:s}=l(e);return s.addColorStop(0,"white"),s.addColorStop(.5,n),s.addColorStop(1,"white"),t.setFill(s),t}function d(e){const{text:t,gradient:s}=l(e);return s.addColorStop(0,"white"),s.addColorStop(1,o),t.setFill(s),t}function l(e){const t=r(e.scene,e.x,e.y,e.content,e.style),s=t.context.createLinearGradient(0,0,0,t.height);return{text:t,gradient:s}}class c extends a.GameObjects.Container{constructor(e,t,s,i,o){super(e,t,s),this.stats={hp:0,atk:0,def:0,res:0,spd:0},e.add.existing(this),this.name=i.name,this.weaponName=i.weaponName,this.image=new a.GameObjects.Image(e,0,0,i.name).setScale(.7),this.add(this.image),this.maxHP=this.HP=i.maxHP,this.stats.atk=i.atk,this.stats.def=i.def,this.stats.res=i.res,this.stats.spd=i.spd,this.team=o;const n=this.image.getBottomCenter().y-20;this.hpBar=new a.GameObjects.Rectangle(e,-13,n,60,5,"team1"===this.team?5562356:16403817).setOrigin(0,0),this.weaponType=new a.GameObjects.Image(e,-30,-40,i.weaponType),this.hpBarBackground=new a.GameObjects.Rectangle(e,-14,n-1,62,7,0).setOrigin(0,0),this.add(this.hpBarBackground),this.add(this.hpBar),this.add(this.weaponType),this.hpText=r(e,-15,n,this.HP,{fontSize:"18px"}).setOrigin(1,.5);const h=this.hpText.context.createLinearGradient(0,0,0,this.hpText.height);h.addColorStop(0,"white"),h.addColorStop(.7,"team1"===this.team?"#54DFF4":"#FA4D69"),this.hpText.setFill(h),this.add(this.hpText),this.setSize(this.image.width,this.image.height),this.unitData=i}attack(e){return[{attacker:this,defender:e,damage:Math.max(0,this.stats.atk-e.stats.def),remainingHP:e.HP-Math.max(0,this.stats.atk-e.stats.def)},{attacker:e,defender:this,damage:Math.max(0,e.stats.atk-this.stats.def),remainingHP:this.HP-Math.max(0,e.stats.atk-this.stats.def)}]}update(){this.hpText.setText(this.HP.toString());const e=this.HP/this.maxHP;this.hpBar.displayWidth=60*e}getMovementRange(){return"cavalry"===this.unitData.movementType?3:"armored"===this.unitData.movementType?1:2}getWeaponRange(){return["sword","lance","axe","dragonstone"].includes(this.unitData.weaponType)?1:2}}const m=c;class p extends a.GameObjects.Container{constructor(e,t,s,i){super(e,t,s),this.nameplate=new a.GameObjects.Image(e,0,0,"nameplate").setScale(.9,.5).setOrigin(0,.5),this.weaponIcon=new a.GameObjects.Image(e,this.nameplate.getLeftCenter().x+22,this.nameplate.getLeftCenter().y,i.weaponType).setScale(1.2),this.heroName=r(e,this.nameplate.getCenter().x,this.nameplate.getCenter().y,i.name,{fontSize:"22px"}).setOrigin(.5),this.add([this.nameplate,this.weaponIcon,this.heroName])}updateNameplate({name:e,weaponType:t}){this.heroName.setText(e),this.weaponIcon.setTexture(t)}}const g=p;class f extends a.GameObjects.Container{constructor(e){super(e,0,0);this.heroPortrait=new a.GameObjects.Image(e,0,0,"").setOrigin(0,0).setScale(.5),this.add(this.heroPortrait);const t=new a.GameObjects.Image(this.scene,20,-40,"unit-bg").setOrigin(0,0);t.setDisplaySize(800,430),this.add(t),this.add(new a.GameObjects.Image(e,170,70,"hp plate").setScale(1.15,.6).setOrigin(0,.5)),this.hp=r(e,190,54,"HP",{fontSize:"20px"}),this.maxHP=d({scene:this.scene,x:310,y:56,content:"",style:{fontSize:"18px"}}),this.nameplate=new g(e,160,25,{name:"",weaponType:""});const s=r(e,590,15,"40+",{fontSize:"20px"});this.atk=r(e,280,89,"",{fontSize:"18px"}).setOrigin(1,0).setColor(i),this.spd=r(e,390,89,"",{fontSize:"18px"}).setOrigin(1,0).setColor(i),this.def=r(e,280,114,"",{fontSize:"18px"}).setOrigin(1,0).setColor(i),this.res=r(e,390,114,"",{fontSize:"18px"}).setOrigin(1,0).setColor(i),this.add([this.nameplate]),this.add([this.atk,this.spd,this.def,this.res,this.hp]),this.add(new a.GameObjects.Image(e,180,111,"stat-line").setScale(.2,.5).setOrigin(0)),this.add(new a.GameObjects.Image(e,180,136,"stat-line").setScale(.2,.5).setOrigin(0)),this.add(r(e,190,89,"Atk",{fontSize:"18px"})),this.add(r(e,300,89,"Spd",{fontSize:"18px"})),this.add(r(e,190,114,"Def",{fontSize:"18px"})),this.add(r(e,300,114,"Res",{fontSize:"18px"})),this.add(r(e,s.getLeftCenter().x,0,"Lv.",{fontSize:"14px"})),this.add(s);const o=new a.GameObjects.Image(e,715,s.getBottomCenter().y,"empty-skill").setScale(.5).setOrigin(0,1),n=new a.GameObjects.Image(e,o.getBottomRight().x,o.getBottomRight().y,"S").setOrigin(1).setScale(.5);this.add(o),this.add(n);const h=new a.GameObjects.Image(e,690,s.getBottomCenter().y,"empty-skill").setScale(.5).setOrigin(0,1),l=new a.GameObjects.Image(e,h.getBottomRight().x,h.getBottomRight().y,"C").setOrigin(1).setScale(.5);this.add(h),this.add(l);const c=new a.GameObjects.Image(e,665,s.getBottomCenter().y,"empty-skill").setScale(.5).setOrigin(0,1),m=new a.GameObjects.Image(e,c.getBottomRight().x,c.getBottomRight().y,"B").setOrigin(1).setScale(.5);this.add(c),this.add(m);const p=new a.GameObjects.Image(e,640,s.getBottomCenter().y,"empty-skill").setScale(.5).setOrigin(0,1),f=new a.GameObjects.Image(e,p.getBottomRight().x,p.getBottomRight().y,"A").setOrigin(1).setScale(.5);this.add(p),this.add(f);const u=new a.GameObjects.Image(this.scene,490,45,"weapon-bg").setOrigin(0,0).setScale(.23,.25);new a.GameObjects.Image(this.scene,490,85,"weapon-bg").setOrigin(0,0).setScale(.23,.25),new a.GameObjects.Image(this.scene,490,125,"weapon-bg").setOrigin(0,0).setScale(.23,.25),new a.GameObjects.Image(this.scene,490,105,"assist-icon").setScale(.45).setOrigin(.25,.5),new a.GameObjects.Image(this.scene,490,135,"special-icon").setScale(.45).setOrigin(.25,.5),this.add(u),this.weaponName=r(this.scene,u.getLeftCenter().x+30,u.getCenter().y,"").setOrigin(0,.5).setStyle({fontSize:"19px"}),this.add(this.weaponName),this.add(new a.GameObjects.Image(this.scene,490,u.getLeftCenter().y,"weapon-icon").setScale(.45).setOrigin(.25,.5)),this.currentHP=d({scene:this.scene,x:250,y:50,content:0,style:{fontSize:"26px"}}),this.add(this.currentHP),this.add(this.maxHP)}setHero(e){this.heroPortrait.setTexture(`${e.name} battle`),this.currentHP.destroy();const t=e.HP<10?h:d;this.currentHP=t({scene:this.scene,x:this.currentHP.x,y:this.currentHP.y,style:{fontSize:"26px"},content:e.HP}),this.add(this.currentHP),this.nameplate.heroName.text!==e.name&&(this.heroPortrait.x=-300,this.scene.tweens.add({targets:this.heroPortrait,x:-50,duration:200})),this.nameplate.updateNameplate({name:e.name,weaponType:e.unitData.weaponType}),this.maxHP.setText(`/ ${e.maxHP}`);for(let t of["atk","def","res","spd"])this[t].setText(e.stats[t].toString());this.weaponName.setText(e.weaponName)}}const u=f;class y extends a.GameObjects.Image{constructor(e,t){super(e,-30,0,`${t} battle`),this.setOrigin(0),this.setScale(.5)}}const x=y;class w extends Phaser.GameObjects.Container{constructor(e){super(e,0,0),this.firstHero={previousHP:null,predictedHP:null,nameplate:null,portrait:null},this.secondHero={previousHP:null,predictedHP:null,nameplate:null,portrait:null};const t=new a.GameObjects.Rectangle(e,0,0,750,400,16702650).setOrigin(0);t.setAlpha(0),this.add(t),this.firstHero.portrait=new x(e,""),this.add(this.firstHero.portrait),this.add(new a.GameObjects.Rectangle(e,750,0,750,400,10104088).setVisible(!0)),this.secondHero.portrait=new x(e,"").setFlipX(!0).setX(1100).setOrigin(1,0),this.add(this.secondHero.portrait),this.firstHero.nameplate=new g(e,100,30,{name:"",weaponType:""}),this.add(this.firstHero.nameplate);const s=60;this.secondHero.nameplate=new g(e,377,30,{name:"",weaponType:""});const i=new a.GameObjects.Image(e,250,85,"unit-bg").setScale(.5,.75),o=new a.GameObjects.Image(e,510,85,"unit-bg").setScale(.5,.75);this.add(this.secondHero.nameplate),this.add([i,o]),this.add(r(e,t.getCenter().x,85,"HP",{fontSize:"22px"}).setOrigin(.5)),this.firstHero.previousHP=d({scene:e,x:200,y:s,style:{fontSize:"36px"},content:""}).setOrigin(1,0),this.firstHero.predictedHP=d({scene:e,x:320,y:s,style:{fontSize:"36px"},content:""}).setOrigin(1,0),this.secondHero.previousHP=d({scene:e,content:49,style:{fontSize:"36px"},x:480,y:s}).setOrigin(1,0);const n=d({scene:e,x:490,y:s,content:"→",style:{fontSize:"36px"}}),l=d({scene:e,x:210,y:s,content:"→",style:{fontSize:"36px"}});this.secondHero.predictedHP=h({scene:e,content:0,x:540,y:s,style:{fontSize:"36px"}}),this.add(this.secondHero.previousHP),this.add(this.secondHero.predictedHP),this.add(n),this.add(l),this.add(this.firstHero.previousHP),this.add(this.firstHero.predictedHP),this.firstPortraitSwitchingTween=e.tweens.create({duration:300,targets:[this.firstHero.portrait],yoyo:!0,alpha:0,onYoyo:()=>{}}),this.secondPortraitSwitchingTween=e.tweens.create({duration:300,targets:[this.secondHero.portrait],yoyo:!0,alpha:0,onYoyo:()=>{}}),this.portraitDisplayTween=e.tweens.create({duration:300,x:800,targets:this.secondHero.portrait})}setForecastData(e){const{attacker:t,defender:s}=e;this.firstHero.nameplate.weaponIcon.setTexture(t.hero.unitData.weaponType),this.firstHero.nameplate.heroName.setText(t.hero.unitData.name),this.secondHero.nameplate.weaponIcon.setTexture(s.hero.unitData.weaponType),this.secondHero.nameplate.heroName.setText(s.hero.unitData.name);const a=t.hero.HP/t.hero.maxHP<.5?" damaged":"",i=s.hero.HP/s.hero.maxHP<.5?" damaged":"";this.firstHero.portrait.setTexture(`${t.hero.name} battle`+a),this.secondHero.portrait.setTexture(`${s.hero.name} battle`+i),this.secondHero.portrait.x=1100,this.portraitDisplayTween.play();const o=t.startHP<10?h:d,n=t.endHP<10?h:d,r=s.startHP<10?h:d,l=s.endHP<10?h:d;let c;this.firstHero.previousHP.destroy(),this.firstHero.predictedHP.destroy(),this.firstHero.previousHP=o({scene:this.scene,x:this.firstHero.previousHP.x,y:this.firstHero.previousHP.y,content:t.startHP,style:{fontSize:"36px"}}).setOrigin(1,0),0===t.endHP&&(c=this.firstHero.portrait),0===s.endHP&&(c=this.secondHero.portrait),this.koTween=this.scene.tweens.create({duration:700,loop:-1,targets:c,yoyo:!0,alpha:.6}),this.koTween.play(),this.firstHero.predictedHP=n({scene:this.scene,x:this.firstHero.predictedHP.x,y:this.firstHero.predictedHP.y,content:t.endHP,style:{fontSize:"36px"}}).setOrigin(1,0),this.add(this.firstHero.predictedHP),this.add(this.firstHero.previousHP),this.secondHero.previousHP.destroy(),this.secondHero.predictedHP.destroy(),this.secondHero.previousHP=r({scene:this.scene,x:this.secondHero.previousHP.x,y:this.secondHero.previousHP.y,content:s.startHP,style:{fontSize:"36px"}}).setOrigin(1,0),this.secondHero.predictedHP=l({scene:this.scene,x:this.secondHero.predictedHP.x,y:this.secondHero.predictedHP.y,content:s.endHP,style:{fontSize:"36px"}}),this.add(this.secondHero.predictedHP),this.add(this.secondHero.previousHP)}runKOTween(e){this.koTween&&this.koTween.destroy(),this.koTween=this.scene.tweens.create({duration:500,loop:-1,targets:[e],yoyo:!0,alpha:.6})}switchPortraits(e,t,s,a){}}const H=w,v=125;function b(e,t){return{x:e*v-63,y:t*v+90}}function P(e,t){return{x:Math.round((63+e)/v),y:Math.round((t-90)/v)}}class S extends Phaser.Scene{constructor(){super({key:"MainScene"}),this.map=[],this.walkCoords=[],this.attackCoords=[],this.displayRange=!1,this.heroes=[],this.team1=[],this.team2=[],this.heroesWhoMoved=[],this.turn="team1",this.rng=new Phaser.Math.RandomDataGenerator,this.terrain=[["wall","floor","floor","floor","floor","floor"],["wall","floor","floor","floor","void","floor"],["floor","floor","floor","floor","floor","floor"],["floor","floor","floor","floor","floor","floor"],["floor","wall","floor","tree","floor","tree"],["floor","tree","floor","floor","floor","wall"],["floor","floor","floor","floor","floor","floor"],["tree","void","void","void","void","tree"]];for(let e=0;e<9;e++){const e=Array.from({length:6}).fill(null);this.map.push(e)}}endAction(e){e.image.setTint(7829367),e.disableInteractive(),this.heroesWhoMoved.push(e),this.displayRange=!1,this.highlightedHero=null}buildArrowPath(e,t,s){let a=e,i=new Map,o=this.getDistance(e,t);for(i.set(`${e.x}-${e.y}`,e),i.set(`${t.x}-${t.y}`,t);o;){const e=O(a).filter((e=>this.heroCanReachTile(s,e)&&this.getDistance(e,t)<o));a=e[0],o=this.getDistance(t,e[0]);const{x:n,y:r}=a;i.set(`${n}-${r}`,a)}return Array.from(i.values()).sort(((t,s)=>this.getDistance(t,e)-this.getDistance(s,e)))}setTurn(e){this.movementAllowedImages.clear();const t="team1"===e?"team2":"team1";this.turn=e,this.heroesWhoMoved=[];for(let t of this[e]){const{x:e,y:s}=P(t.x,t.y);let i={x:e,y:s};t.setInteractive(!0),this.input.setDraggable(t,!0);const o=new Phaser.GameObjects.Image(this,t.x,t.y,"movement-allowed").setName(`movement-${t.name}`);this.add.existing(o);const n=this.getTile(i.x+"-"+i.y);let h;o.setDisplaySize(n.width,n.height),this.movementAllowedImages.add(o);let d="";t.off("pointerdown"),t.on("pointerdown",(()=>{this.movementAllowedImages.setVisible(!1);const e=this.children.getByName(`movement-${t.name}`);e.setVisible(!0),h=this.add.image(e.x,e.y,"rosary").setDisplaySize(e.width,e.height).setScale(1.35).setName("arrow"),this.movementAllowedTween.pause(),this.sound.play("enabled-unit");const s=P(t.x,t.y),a=this.rng.integerInRange(1,3);d&&this.sound.stopByKey(d);const i=`${t.unitData.name} ${a}`;this.sound.play(i,{volume:.2}),d=i,this.unitInfosBanner.setVisible(!0).setHero(t),this.displayRanges(s,t.getMovementRange(),t.getWeaponRange())}));let l="";const c=new a.GameObjects.Image(this,0,0,"end-arrow").setName("end-arrow");this.movementArrows.add(c),t.on("dragover",((e,s)=>{var a,o;if(this.walkCoords.includes(s.name)&&s.name!==l){this.combatForecast.setVisible(!1),this.sound.play("hover");const e=s.name.split("-").map(Number),a=this.buildArrowPath(Object.assign({},i),{x:e[0],y:e[1]},t);h.setTexture("rosary"),this.movementArrows.clear(!0);for(let e=0;e<a.length;e++){const t=a[e-1],s=a[e];if(e&&this.add.existing(c),t&&a[e-2]){const i=k(a[e-2],s),o=this.getTile(t.x+"-"+t.y);var n=i.x?i.y?`path-${i.y}-${i.x}`:"horizontal":"vertical";const r=new Phaser.GameObjects.Image(this,o.x,o.y,n);this.add.existing(r),this.movementArrows.add(r)}if(1===e){const e=k(t,s),a="up"===e.y?180:"down"===e.y?0:null,i="left"===e.x?90:"right"===e.x?-90:null,o=null!=a?a:i;h.setTexture("rosary-arrow"),h.setRotation(o*Math.PI/180)}if(e===a.length-1&&e){const e=a[a.length-1],s=this.getTile(e.x+"-"+e.y);c.x=s.x,c.y=s.y;const i=k(t,e),o="left"===i.x?180:"right"===i.x?0:null,n="up"===i.y?-90:"down"===i.y?90:null,r=null!=o?o:n;c.setRotation(r*Math.PI/180)}}l=s.name}else if(this.attackCoords.includes(s.name)){const[e,i]=s.name.split("-");if((null!==(o=null===(a=this.map[+i][+e])||void 0===a?void 0:a.team)&&void 0!==o?o:t.team)!==t.team&&!this.combatForecast.visible){const s=this.map[+i][+e];this.unitInfosBanner.setVisible(!1),this.combatForecast.setForecastData({attacker:{hero:t,startHP:t.maxHP,endHP:Math.max(t.HP-(s.stats.atk-t.stats.def),0),statChanges:{},turns:1,damage:49},defender:{hero:s,startHP:s.maxHP,endHP:Math.max(s.HP-(t.stats.atk-s.stats.def),0),statChanges:{},turns:1,damage:49}}),this.combatForecast.setVisible(!0)}}})),t.off("dragend"),t.on("dragend",(({upX:e,upY:s})=>{const{x:a,y:o}=P(e,s);if(this.children.remove(this.children.getByName("arrow")),!this.walkCoords.includes(a+"-"+o)||this.map[o][a]||i.x===a&&i.y===o)if(this.attackCoords.includes(a+"-"+o)&&this.map[o][a]&&this.map[o][a].team!==t.team){const e=this.getTilesInShallowRange({x:a,y:o},t.getWeaponRange()),[s]=C(Array.from(e.keys()),this.walkCoords),[n,h]=s.split("-");this.moveHero(t,i,{x:+n,y:+h}),i.x=+n,i.y=+h;const d=this.map[o][a],l=t.attack(d),c=this.tweens.timeline();c.on("complete",(()=>{const e=[t,d].find((e=>0===e.HP)),s=[t,d].find((e=>!!e.HP));e?this.tweens.add({targets:e,alpha:0,delay:700,onStart:()=>{this.sound.play("ko",{volume:.4})},onComplete:()=>{this.displayRange=!1,this.heroes=this.heroes.filter((t=>t.name!==e.name)),this[e.team]=this[e.team].filter((t=>t.name!==e.name));const{x:t,y:a}=P(e.x,e.y);this.map[a][t]=null,e.destroy(),this.movementArrows.setVisible(!1),this.movementArrows.clear(!0),s.team===this.turn&&this.endAction(s),this.game.input.enabled=!0},duration:900}):(this.endAction(t),this.game.input.enabled=!0)}));for(let e=0;e<l.length;e++){const t=l[e],s=900*e+40,a=t.defender.image.getCenter(),i=r(this,t.defender.x+a.x,t.defender.y+a.y,t.damage.toString(),{stroke:"#FFFFFF",strokeThickness:5,color:"red",fontSize:"30px"}).setOrigin(.4);c.add({targets:t.attacker,x:"-="+(t.attacker.x-t.defender.x)/2,y:"-="+(t.attacker.y-t.defender.y)/2,yoyo:!0,duration:100,onStart:()=>{this.sound.play("hit"),t.defender.HP=Math.max(0,t.defender.HP-t.damage),this.add.existing(i),this.tweens.add({targets:[i],y:t.defender.image.getTopCenter().y+t.defender.y,yoyo:!0,duration:100,onComplete:()=>{setTimeout((()=>{i.destroy()}),500)}})},delay:s})}this.game.input.enabled=!1,c.play()}else{const e=b(i.x,i.y);this.tweens.add({targets:t,x:e.x,y:e.y,duration:100})}else{this.combatForecast.setVisible(!1),this.map[i.y][i.x]=null,i.x=a,i.y=o,this.map[i.y][i.x]=t;const e=b(a,o);t.x=e.x,t.y=e.y,this.movementArrows.setVisible(!1),this.movementArrows.clear(!0),this.movementAllowedImages.setVisible(!0),this.movementAllowedTween.resume(),this.children.getByName(`movement-${t.name}`).setVisible(!1),this.sound.play("confirm",{volume:.4}),this.endAction(t),this.children.remove(c)}}))}this.movementAllowedTween=this.tweens.add({targets:this.movementAllowedImages.getChildren(),loop:-1,yoyo:!0,duration:900,alpha:0});for(let e of this[t])e.off("dragover"),e.off("dragend"),e.setInteractive(),this.children.remove(this.children.getByName("movement-"+e.name)),e.image.clearTint(),this.input.setDraggable(e,!1),e.off("dragstart"),e.off("pointerdown"),e.on("pointerdown",(()=>{this.displayRanges(P(e.x,e.y),e.getMovementRange(),e.getWeaponRange()),this.sound.play("enabled-unit"),this.highlightedHero=e,this.unitInfosBanner.setVisible(!0).setHero(e)}))}preload(){this.load.image("map","assets/testmap.png"),this.load.image("Byleth","assets/mini/Byleth.png"),this.load.image("Dimitri","assets/mini/Dimitri.png"),this.load.image("Chrom","assets/mini/Chrom.png"),this.load.image("Lucina","assets/mini/Lucina.png"),this.load.image("movement-allowed","assets/movement-allowed.png"),this.load.image("sword","assets/sword.png"),this.load.image("lance","assets/lance.png"),this.load.audio("enabled-unit","assets/audio/q.mp3"),this.load.audio("disabled-unit","assets/audio/feh disabled unit.mp3"),this.load.audio("hit","assets/audio/hit.mp3"),this.load.audio("ko","assets/audio/ko.mp3"),this.load.audio("hover","assets/audio/hover on tile.mp3"),this.load.audio("confirm","assets/audio/confirm.mp3"),this.load.image("nameplate","assets/nameplate.png"),this.load.image("end-arrow","assets/end-arrow.png"),this.load.image("empty-skill","assets/empty-skill.png"),this.load.image("path-down-right","assets/path-down-left.png"),this.load.image("path-down-left","assets/path-down-right.png"),this.load.image("path-up-right","assets/path-up-right.png"),this.load.image("path-up-left","assets/path-up-left.png"),this.load.image("horizontal","assets/horizontal.png"),this.load.image("vertical","assets/vertical.png"),this.load.image("unit-bg","assets/unitbg.png"),this.load.image("rosary","assets/rosary-current.png"),this.load.image("rosary-arrow","assets/rosary-arrow.png"),this.load.image("weapon-icon","assets/weapon_icon.png"),this.load.image("weapon-bg","assets/weapon.png"),this.load.image("assist-icon","assets/assist-icon.png"),this.load.image("special-icon","assets/special-icon.png"),this.load.audio("bgm","assets/audio/leif's army in search of victory.mp3");for(let e of["Chrom","Byleth","Dimitri","Lucina"])this.load.audio(`${e} 1`,`assets/audio/quotes/${e}_1.mp3`),this.load.audio(`${e} 2`,`assets/audio/quotes/${e}_2.mp3`),this.load.audio(`${e} 3`,`assets/audio/quotes/${e}_3.mp3`),this.load.image(`${e} battle`,`assets/battle/${e}.png`),this.load.image(`${e} damage`,`assets/battle/${e} battle damage.png`);this.load.image("hp plate","assets/hp plate.png"),this.load.image("stat-line","assets/stat-glowing-line.png");for(let e of["A","B","C","S"])this.load.image(e,`assets/${e}.png`)}addHero(e,t){const{x:s,y:a}=b(e.gridX,e.gridY),i=new m(this,s,a,e,t).setInteractive();return this.add.existing(i),this.heroes.push(i),this.map[e.gridY][e.gridX]=i,this[t].push(i),i}moveHero(e,t,s){this.map[t.y][t.x]=null,this.map[s.y][s.x]=e;const{x:a,y:i}=b(s.x,s.y);e.x=a,e.y=i}getNearestToAttackTile(e,t){const s=this.getTilesInShallowRange(t,e.getWeaponRange());return s.size?s:null}create(){this.movementAllowedImages=this.add.group(),this.movementArrows=this.add.group(),this.heroBackground=this.add.rectangle(0,0,1500,400,2057609),this.unitInfosBanner=this.add.existing(new u(this).setVisible(!1)),this.combatForecast=this.add.existing(new H(this).setVisible(!1)),this.sound.play("bgm",{volume:.1,loop:!0}),this.add.image(0,150,"map").setDisplaySize(750,1e3).setOrigin(0,0);for(let e=1;e<9;e++)for(let t=1;t<7;t++){const{x:s,y:a}=b(t,e),i=t+"-"+e,o=this.add.rectangle(s,a,v,v,0).setAlpha(.2).setName(i).setInteractive(void 0,void 0,!0);o.on("pointerdown",(()=>{const[e,t]=i.split("-");if(this.walkCoords.includes(i)&&this.highlightedHero){const{x:s,y:a}=b(+e,+t);this.tweens.add({targets:this.highlightedHero,x:s,y:a,duration:200})}else this.map[+t][+e]||(this.displayRange&&this.sound.play("disabled-unit"),this.displayRange=!1,this.movementAllowedImages.setVisible(!0),this.movementAllowedTween.resume(),this.movementArrows.clear(!0))})),this.add.text(o.getCenter().x,o.getCenter().y,i,{fontSize:"18px"})}this.addHero({name:"Dimitri",weaponName:"Areadbhar",gridX:3,gridY:7,weaponType:"lance",movementType:"cavalry",maxHP:40,atk:57,def:37,res:18,spd:41},"team1"),this.addHero({name:"Byleth",gridX:3,weaponName:"Sword of the Creator",gridY:1,weaponType:"sword",movementType:"infantry",maxHP:40,atk:52,def:34,spd:38,res:20},"team1"),this.addHero({name:"Chrom",gridX:6,gridY:1,weaponName:"Revenge Falchion",weaponType:"sword",movementType:"infantry",atk:57,def:5,res:19,maxHP:49,spd:27},"team2"),this.addHero({name:"Lucina",weaponName:"Parallel Falchion",gridX:6,gridY:4,weaponType:"sword",movementType:"infantry",atk:50,def:25,spd:36,maxHP:43,res:19},"team2"),this.input.on("drag",((e,t,s,a)=>{t instanceof m&&t.team===this.turn&&(t.x=s,t.y=a)})),this.setTurn("team1")}displayRanges(e,t,s){this.displayRange=!0;const a=this.getTilesInRange(e,t);for(let[t,s]of a.entries())this.heroCanReachTile(this.map[e.y][e.x],s)||a.delete(t);const i=function(e,t){const s=new Map;for(let[a,i]of e.entries())t.has(a)||s.set(a,i);for(let[a,i]of t.entries())e.has(a)||s.set(a,i);return s}(a,this.getTilesInRange(e,s,a,!0)),o=Array.from(a.keys()),n=Array.from(i.keys());for(let e of this.walkCoords)o.includes(e)||this.getTile(e).setFillStyle(0);for(let e of this.attackCoords)n.includes(e)||this.getTile(e).setFillStyle(0);this.walkCoords=o,this.attackCoords=n}getTile(e){return this.children.getByName(e)}getTilesInRange(e,t,s,a){let i=s?Array.from(s.values()):[e];const o=s?new Map(s||void 0):new Map,n=this.map[e.y][e.x];for(let e=0;e<t;e++)i=i.map(O).flat(),a||(i=i.filter((e=>this.heroCanReachTile(n,e))));for(let e of i)o.has(`${e.x}-${e.y}`)||o.set(`${e.x}-${e.y}`,e);return o}getTilesInShallowRange(e,t){const s=this.getTilesInRange(e,t);return s.forEach(((a,i)=>{this.getDistance(a,e)!==t&&s.delete(i)})),s}getDistance(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}heroCanReachTile(e,t){const s=this.map[t.y][t.x];if(Boolean(s)&&s.team!==e.team)return!1;const a=this.terrain[t.y-1][t.x-1];if("wall"===a)return!1;if("void"===a)return"flier"===e.unitData.movementType;if("flier"===e.unitData.movementType)return!0;const{x:i,y:o}=P(e.x,e.y);if("cavalry"===e.unitData.movementType&&"trench"===a)return this.getDistance({x:i,y:o},t)<=1;if("tree"===a)switch(e.unitData.movementType){case"cavalry":return!1;case"infantry":return this.getDistance({x:i,y:o},t)<=1;default:return!0}return!0}update(){if(this.displayRange){for(let e of this.walkCoords)this.children.getByName(e).setFillStyle(255);for(let e of this.attackCoords)this.children.getByName(e).setFillStyle(16711680)}else{for(let e of[...this.attackCoords,...this.walkCoords])this.getTile(e).setFillStyle(0);this.walkCoords=[],this.attackCoords=[]}for(let e of this.heroes)e.update();if(this.heroesWhoMoved.length===this[this.turn].length){const e="team1"===this.turn?"team2":"team1";this.setTurn(e)}}}function T(e){return e.x>=1&&e.x<=6&&e.y>=1&&e.y<=8}function O(e){const{x:t,y:s}=e,a=[e];return a.push({x:t+1,y:s}),a.push({x:t-1,y:s}),a.push({x:t,y:s+1}),a.push({x:t,y:s-1}),a.filter(T)}function k(e,t){const s={y:"",x:""};return e.y!==t.y&&(s.y=e.y<t.y?"down":"up"),e.x!==t.x&&(s.x=e.x<t.x?"right":"left"),s}function C(e,t){const s=[];for(let a of e)t.includes(a)&&s.push(a);for(let a of t)e.includes(a)&&s.push(a);return Array.from(new Set(s))}class I extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}create(){this.scene.start("MainScene")}}const A={type:Phaser.CANVAS,backgroundColor:"#ffffff",scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:750,height:1100},scene:[I,S]};window.addEventListener("load",(()=>{new Phaser.Game(A)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function a(e){var i=s[e];if(void 0!==i)return i.exports;var o=s[e]={exports:{}};return t[e].call(o.exports,o,o.exports,a),o.exports}a.m=t,e=[],a.O=(t,s,i,o)=>{if(!s){var n=1/0;for(l=0;l<e.length;l++){for(var[s,i,o]=e[l],r=!0,h=0;h<s.length;h++)(!1&o||n>=o)&&Object.keys(a.O).every((e=>a.O[e](s[h])))?s.splice(h--,1):(r=!1,o<n&&(n=o));if(r){e.splice(l--,1);var d=i();void 0!==d&&(t=d)}}return t}o=o||0;for(var l=e.length;l>0&&e[l-1][2]>o;l--)e[l]=e[l-1];e[l]=[s,i,o]},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var i,o,[n,r,h]=s,d=0;if(n.some((t=>0!==e[t]))){for(i in r)a.o(r,i)&&(a.m[i]=r[i]);if(h)var l=h(a)}for(t&&t(s);d<n.length;d++)o=n[d],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(l)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),a.O(void 0,[216],(()=>a(660)));var i=a.O(void 0,[216],(()=>a(204)));i=a.O(i)})();