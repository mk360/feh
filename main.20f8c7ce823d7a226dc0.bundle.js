/*! For license information please see main.20f8c7ce823d7a226dc0.bundle.js.LICENSE.txt */
(()=>{var e,t={775:(e,t,s)=>{"use strict";var a=s(260);function o(e,t,s,a,o){return new Phaser.GameObjects.Text(e,t,s,a.toString(),Object.assign({fontFamily:"'FEH'",stroke:"black",strokeThickness:2},o))}class n extends a.GameObjects.Container{constructor(e,t,s,n,i){super(e,t,s),this.setData("hero",n),this.statuses=[],this.setName(n.id),this.image=new a.GameObjects.Image(e,0,0,n.name,"map").setScale(.7).setDepth(1),this.add(this.image),this.team=i;const r=this.image.getBottomCenter().y-20;this.hpBar=new a.GameObjects.Rectangle(e,-13,r,60,5,"team1"===this.team?5562356:16403817).setOrigin(0,0).setDepth(2),this.weaponType=new a.GameObjects.Image(e,-30,-40,"weapons",`${n.getWeapon().color}-${n.getWeapon().type}`),this.hpBarBackground=new a.GameObjects.Rectangle(e,-14,r-1,62,7,0).setOrigin(0,0),this.add(this.hpBarBackground),this.add(this.hpBar),this.add(this.weaponType),this.hpText=o(e,-15,r,n.maxHP,{fontSize:"18px"}).setOrigin(1,.5);const l=this.hpText.context.createLinearGradient(0,0,0,this.hpText.height);l.addColorStop(0,"white"),l.addColorStop(.7,"team1"===this.team?"#54DFF4":"#FA4D69"),this.hpText.setFill(l),this.add(this.hpText),this.setSize(this.image.width,this.image.height)}getInternalHero(){return this.data.get("hero")}update(){const{maxHP:e,stats:{hp:t}}=this.getInternalHero();this.hpText.setText(t.toString());const s=t/e;this.hpBar.displayWidth=60*s}getMovementRange(){const{movementType:e}=this.getInternalHero();return"cavalry"===e?3:"armored"===e?1:2}getNextIndex(e,t){return t===e.length-1?0:t+1}getWeaponRange(){return["sword","lance","axe","dragonstone"].includes(this.getInternalHero().getWeapon().type)?1:2}}const i=n;var r=s(944),l=s.n(r);const h=new(l().Hero)({name:"Ryoma",weaponColor:"red",weaponType:"sword",stats:{hp:41,atk:34,spd:39,def:28,res:20},movementType:"flier"}),d=new(l().Hero)({name:"Lyn",stats:{hp:35,atk:33,spd:35,def:18,res:28},movementType:"cavalry"}),m=new(l().Hero)({name:"Ike",stats:{hp:41,atk:36,spd:30,def:35,res:21},movementType:"infantry"}),p=new(l().Hero)({name:"Corrin",stats:{hp:42,atk:35,spd:35,def:31,res:24},movementType:"infantry"}),c=new(l().Hero)({name:"Lucina",movementType:"infantry",stats:{hp:41,atk:34,spd:36,def:27,res:19}}),g=new(l().Hero)({name:"Robin",weaponColor:"colorless",weaponType:"dragonstone",stats:{hp:40,atk:32,spd:35,def:30,res:25},movementType:"flier"}),f=new(l().Hero)({name:"Ephraim",weaponColor:"green",weaponType:"axe",stats:{hp:46,atk:38,spd:27,def:37,res:26},movementType:"armored"}),u=new(l().Hero)({name:"Hector",weaponColor:"green",weaponType:"axe",stats:{hp:47,atk:40,spd:23,def:38,res:26},movementType:"armored"}),y=new(l().Weapon);y.setName("Mulagir").setMight(14).setType("bow").setColor("colorless").setEffectiveness("flier"),y.onEquip=e=>{e.raiseStat("spd",3)},y.onBeforeCombat=({enemy:e,wielder:t})=>{"tome"===e.getWeapon().type&&e.lowerCursor("mapBuff",1),"flier"===e.movementType&&t.raiseCursor("effectiveness",1)};const w=new(l().Weapon);w.setType("sword").setColor("red").setMight(19).setName("Ragnell"),w.onDefense=e=>{e.wielder.raiseCursor("counterattack",1)};const S=new(l().Weapon)({name:"Draconic Rage",might:16,range:1,type:"dragonstone",color:"blue",description:"Accelerates Special trigger (cooldown count-1). If the number of allies within 2 spaces (excluding unit) > the number of foes within 2 spaces (excluding target), grants Atk/Spd+5 during combat. If foe's Range = 2, calculates damage using the lower of foe's Def or Res."});S.onBeforeCombat=({wielder:e,enemy:t})=>{let s=0,a=0;for(let t of e.allies)e.getDistance(t)<=2&&s++;for(let s of t.allies)s.getDistance(e)<=2&&a++;s>a&&e.setBattleMods({atk:5,spd:5}),2===t.getWeapon().range&&e.raiseCursor("lowerOfDefAndRes",1)};const k=new(l().Weapon)({name:"Expiration",might:16,range:1,type:"dragonstone",color:"colorless",description:"Unit can counterattack regardless of foe's range. If foe's Range = 2, calculates damage using the lower of foe's Def or Res."});k.onEquip=e=>{e.raiseCursor("counterattack",1)},k.onBeforeCombat=({wielder:e,enemy:t})=>{2===t.getWeapon().range&&e.raiseCursor("lowerOfDefAndRes",1)};const v=new(l().Weapon)({name:"GeirskÃ¶gul",type:"lance",color:"blue",might:16,range:1,description:"Grants Def+3. If allies within 2 spaces use sword, lance, axe, bow, dagger, or beast damage, grants Atk/Spd+3 to those allies during combat."});v.onBeforeAllyCombat=({ally:e,wielder:t})=>{e.getDistance(t)<=2&&["sword","lance","axe","bow","dagger","beast"].includes(e.getWeapon().type)&&e.setBattleMods({atk:3,spd:3})};const x=new(l().Weapon)({name:"Thunder Armads",type:"axe",color:"green",might:16,range:1,description:"Grants Def+3. If unit is within 3 spaces of an ally, inflicts Atk/Def-5 on foe during combat and foe cannot make a follow-up attack."});x.onEquip=e=>{e.raiseStat("def",3)},x.onBeforeCombat=({wielder:e,enemy:t})=>{let s=0,a=0;for(let t of e.allies)e.getDistance(t)<=2&&s++;for(let t of e.enemies)e.getDistance(t)<=2&&a++;s>a&&t.lowerCursor("followup",1)};const b=new(l().Weapon);b.setName("Garm").setType("axe").setColor("green").setMight(16).setRange(1),b.onEquip=e=>{e.raiseStat("atk",3)},b.onBeforeCombat=({wielder:e})=>{e.statuses.length&&e.raiseCursor("followup",1)};const C=new(l().Weapon)({range:1,might:16,type:"sword",color:"red",name:"Raijinto",description:"Unit can counterattack regardless of range."});C.onDefense=({wielder:e})=>{e.raiseCursor("counterattack",1)};const B=new(l().PassiveSkill);B.setName("Distant Counter"),B.setSlot("A"),B.onDefense=({wielder:e})=>{e.raiseCursor("counterattack",1)};const T=new(l().PassiveSkill);T.setName("Vengeful Fighter 3"),T.setSlot("B"),T.onDefense=({wielder:e})=>{e.stats.hp/e.maxHP>=.5&&e.raiseCursor("followup",1)};const A=new(l().PassiveSkill);A.setName("Dragonskin"),A.setSlot("A"),A.setDescription('Neutralizes "effective against flying" bonuses. If foe initiates combat, grants Def/Res+4 during combat.'),A.onBeforeCombat=({enemy:e})=>{e.getWeapon().effectiveAgainst.includes("flier")&&e.lowerCursor("effectiveness",1)},A.onDefense=({wielder:e})=>{e.setBattleMods({def:4,res:4})};const I=(new(l().PassiveSkill)).setName("Sturdy Blow 2").setSlot("A");I.onInitiate=({wielder:e})=>{e.setBattleMods({atk:4,def:4})};const D=(new(l().PassiveSkill)).setName("Drive Spd 2").setSlot("C");D.onBeforeAllyCombat=({ally:e,wielder:t})=>{t.getDistance(e)<=2&&e.setBattleMods({spd:3})};const H=new(l().PassiveSkill);H.setName("Atk/Res Bond 3").setSlot("S"),H.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(1===e.getDistance(t))return void e.setBattleMods({atk:5,res:5})};const R=new(l().PassiveSkill);R.setName("Atk/Def Bond 3").setSlot("A"),R.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(1===e.getDistance(t))return void e.setBattleMods({atk:5,def:5})};const M=(new(l().PassiveSkill)).setName("Atk/Res Form 3").setSlot("S"),N=(new(l().PassiveSkill)).setName("Sacae's Blessing").setSlot("B");N.onInitiate=({enemy:e})=>{["sword","axe","lance"].includes(e.getWeapon().type)&&e.lowerCursor("counterattack",1)},M.onBeforeCombat=({wielder:e})=>{let t=0;for(let s of e.allies)e.getDistance(s)<=2&&t++;const s=Math.min(2*t+1,7);e.setBattleMods({atk:s,res:s})},H.slot="A";const P=(new(l().PassiveSkill)).setName("Spd/Res Rein 3").setSlot("C");P.onBeforeAllyCombat=({wielder:e,enemy:t})=>{e.getDistance(t)<=2&&t.setBattleMods({spd:-4,res:-4})},P.onBeforeCombat=({enemy:e})=>{e.setBattleMods({spd:-4,res:-4})};const W=(new(l().PassiveSkill)).setName("Kestrel Stance 2").setSlot("A");W.onDefense=({wielder:e})=>{e.setBattleMods({atk:4,spd:4})};const q=(new(l().PassiveSkill)).setName("Atk/Spd Rein 3").setSlot("C");q.onBeforeAllyCombat=({wielder:e,enemy:t})=>{e.getDistance(t)<=2&&t.setBattleMods({atk:-4,spd:-4})},q.onBeforeCombat=({enemy:e})=>{e.setBattleMods({atk:-4,spd:-4})};const O=(new(l().PassiveSkill)).setName("Warding Breath").setSlot("A");O.onDefense=({wielder:e})=>{e.setBattleMods({res:4})};const j=(new(l().PassiveSkill)).setName("Joint Drive Res").setSlot("C");j.onBeforeAllyCombat=({ally:e,wielder:t})=>{t.getDistance(e)<=2&&e.setBattleMods({res:4})},j.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(e.getDistance(t)<=2)return void e.setBattleMods({res:4})};const E=(new(l().PassiveSkill)).setName("Seal Atk/Def 2").setSlot("B");E.onAfterCombat=({enemy:e,wielder:t})=>(e.allies.filter((t=>t.getDistance(e)<=2)),[]);const $=(new(l().PassiveSkill)).setName("Bushido II").setSlot("B");$.onBeforeCombat=({wielder:e,enemy:t,damage:s})=>{if(e.raiseCursor("damageIncrease",7),t.getWeapon().effectiveAgainst.includes("flier")&&t.lowerCursor("effectiveness",1),e.getBattleStats().spd>t.getBattleStats().spd){const a=Math.min(40,4*(e.getBattleStats().spd-t.getBattleStats().spd));console.log({reductionPercentage:a,damage:s}),e.raiseCursor("damageReduction",s-Math.floor(s*a))}};const F=(new(l().PassiveSkill)).setSlot("A").setName("Close Def 3");F.onDefense=({wielder:e,enemy:t})=>{1===t.getWeapon().range&&e.setBattleMods({def:6,res:6})};const G=(new(l().PassiveSkill)).setName("Swift Sparrow 3").setSlot("A");G.onInitiate=({wielder:e})=>{e.setBattleMods({atk:6,spd:6})};const z=(new(l().PassiveSkill)).setName("Ostia's Pulse II").setSlot("C");z.onTurnStart=({wielder:e})=>{const t=[];let s={armored:1,infantry:0,flier:0,cavalry:0};const a=[e];for(let t of e.allies)1===e.getDistance(t)&&a.push(t),s[t.movementType]++;for(let e of a)s[e.movementType]<=2&&t.push({targetHeroId:e.id,appliedEffect:{stats:{def:6,res:6}}});return t};const V=(new(l().PassiveSkill)).setName("Windsweep 3").setSlot("B");V.onInitiate=({wielder:e,enemy:t})=>{e.lowerCursor("followup",1),["sword","lance","axe","dagger","bow","beast"].includes(t.getWeapon().type)&&t.lowerCursor("counterattack",1)};const _=(new(l().PassiveSkill)).setName("Atk/Spd Bond 4").setSlot("S");_.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(1===e.getDistance(t)){const t={atk:7,spd:7};for(let s in e.mapMods)e.mapMods[s]<0&&(t[s]+=-e.mapMods[s],e.mapMods[s]=0);return void e.setBattleMods(t)}};const L=(new(l().PassiveSkill)).setName("Null Follow-Up 3").setSlot("B");L.onBeforeCombat=({wielder:e})=>{e.raiseCursor("followup",1)};const U=(new(l().PassiveSkill)).setName("Swordbreaker 3").setSlot("B");U.onBeforeCombat=({wielder:e,enemy:t})=>{"sword"===t.getWeapon().type&&(e.raiseCursor("followup",1),t.lowerCursor("followup",1))};const K=(new(l().PassiveSkill)).setName("Atk/Def Solo 4").setSlot("S");K.onBeforeCombat=({wielder:e})=>{for(let t of e.allies)if(1===e.getDistance(t))return;e.setBattleMods({atk:7,def:7})};const J=(new(l().PassiveSkill)).setName("Spd Smoke 3").setSlot("S"),X=(new(l().PassiveSkill)).setName("Atk Smoke 3").setSlot("C"),Y=(new(l().PassiveSkill)).setName("Res Smoke 3").setSlot("S"),Q=(new(l().PassiveSkill)).setName("Hone Spd 2").setSlot("C"),Z=(new(l().PassiveSkill)).setName("Armor March 3").setSlot("S"),ee=(new(l().PassiveSkill)).setName("Special Fighter 3").setSlot("B");u.equipSkill(B),u.equipSkill(T),u.setWeapon(x),u.equipSkill(z),u.equipSkill(Z),Z.slot="C",p.setWeapon(S),p.equipSkill(R),p.equipSkill(M),p.equipSkill(L),p.equipSkill(Q),c.setWeapon(v),c.equipSkill(I),c.equipSkill(_),c.equipSkill(D),c.equipSkill(V),f.equipSkill(F),f.setWeapon(b),f.equipSkill(K),f.equipSkill(Z),f.equipSkill(ee),g.equipSkill(P),g.setWeapon(k),g.equipSkill(A),g.equipSkill(Y),g.equipSkill(U),d.setWeapon(y),d.equipSkill(G),d.equipSkill(N),d.equipSkill(X),d.equipSkill(J),h.setWeapon(C),h.equipSkill(W),h.equipSkill(q),h.equipSkill($),h.equipSkill(J),m.setWeapon(w),m.equipSkill(j),m.equipSkill(O),m.equipSkill(E),m.equipSkill(M);const te=new class{constructor(){this.team1=[],this.team2=[],this.map={};for(let e=1;e<9;e++)this.map[e]=Array.from({length:6}).fill(null)}getDistance(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}moveHero(e,t){const s=e.coordinates;this.map[s.y][s.x]=null,e.coordinates=t,this.map[t.y][t.x]=e}addHero(e,t,s){e.coordinates=s,this[t].push(Object.assign({hero:e},s))}startCombat(e,t){return new(l().Combat)({attacker:e,defender:t}).createCombat()}setAlliesAndEnemies(){for(let e=0;e<this.team1.length;e++){for(let t=e+1;t<this.team1.length;t++)this.team1[e].hero.setAlly(this.team1[t].hero),this.team1[t].hero.setAlly(this.team1[e].hero);for(let t=0;t<this.team2.length;t++)this.team1[e].hero.setEnemy(this.team2[t].hero)}for(let e=0;e<this.team2.length;e++){for(let t=e+1;t<this.team2.length;t++)this.team2[e].hero.setAlly(this.team2[t].hero),this.team2[t].hero.setAlly(this.team2[e].hero);for(let t=0;t<this.team2.length;t++)this.team2[e].hero.setEnemy(this.team1[t].hero)}this.effectRunner=new(l().MapEffectRunner)(this.team1.map((({hero:e})=>e)),this.team2.map((({hero:e})=>e)))}getMapEffects(e,t){return this.effectRunner.runEffects(t,e)}};te.addHero(u,"team1",{x:4,y:1}),te.addHero(c,"team1",{y:1,x:2}),te.addHero(h,"team1",{x:3,y:1}),te.addHero(g,"team1",{x:5,y:1}),te.addHero(m,"team2",{y:7,x:6}),te.addHero(p,"team2",{y:7,x:4}),te.addHero(f,"team2",{x:3,y:7}),te.addHero(d,"team2",{y:3,x:5}),te.setAlliesAndEnemies();const se=te,ae=125;function oe(e,t){return{x:e*ae-63,y:t*ae+90}}function ne(e,t){return{x:Math.round((63+e)/ae),y:Math.round((t-90)/ae)}}class ie extends Phaser.Scene{constructor(){super({key:"MainScene"}),this.map=[],this.walkCoords=[],this.attackCoords=[],this.displayRange=!1,this.heroes=[],this.team1=[],this.team2=[],this.heroesWhoMoved=[],this.turn="team1",this.rng=new Phaser.Math.RandomDataGenerator,this.terrain=[["wall","floor","floor","floor","floor","floor"],["wall","floor","floor","floor","void","floor"],["floor","floor","floor","floor","floor","floor"],["floor","floor","floor","floor","floor","floor"],["floor","wall","floor","tree","floor","tree"],["floor","tree","floor","floor","floor","wall"],["floor","floor","floor","floor","floor","floor"],["tree","void","void","void","void","tree"]];for(let e=0;e<9;e++){const e=Array.from({length:6}).fill(null);this.map.push(e)}}fillTiles(e,t,s=1){for(let a of e)this.getTile(a).setFillStyle(t,s)}clearTiles(e){for(let t of e)this.getTile(t).setFillStyle(0)}endAction(e){e.image.setTint(7829367),e.disableInteractive(),this.heroesWhoMoved.push(e),this.displayRange=!1,this.children.remove(this.children.getByName("movement-"+e.getInternalHero().name)),this.highlightedHero=null}buildArrowPath(e,t,s){let a=e,o=new Map,n=this.getDistance(e,t);for(o.set(`${e.x}-${e.y}`,e),o.set(`${t.x}-${t.y}`,t);n;){const e=le(a).filter((e=>this.heroCanReachTile(s,e)&&this.getDistance(e,t)<n));a=e[0],n=this.getDistance(t,e[0]);const{x:i,y:r}=a;o.set(`${i}-${r}`,a)}return Array.from(o.values()).sort(((t,s)=>this.getDistance(t,e)-this.getDistance(s,e)))}setTurn(e){this.movementAllowedImages.clear();const t="team1"===e?"team2":"team1";this.turn=e,this.heroesWhoMoved=[];const s=se.getMapEffects(e,"turnStart");for(let t of this[e]){const{x:e,y:s}=ne(t.x,t.y);let n={x:e,y:s};t.setInteractive(new a.Geom.Rectangle(0,0,40,40)).setDepth(1),this.input.setDraggable(t,!0);const i=new Phaser.GameObjects.Image(this,t.x,t.y,"movement-allowed").setName(`movement-${t.getInternalHero().name}`).setDepth(0);this.add.existing(i);const r=this.getTile(n.x+"-"+n.y);let l;i.setDisplaySize(r.width,r.height),this.movementAllowedImages.add(i);let h="";t.off("pointerdown"),t.on("pointerdown",(()=>{const e=ne(t.x,t.y);this.movementAllowedImages.setVisible(!1);const s=this.children.getByName(`movement-${t.getInternalHero().name}`);s.setVisible(!0),l=this.add.image(s.x,s.y,"rosary").setDisplaySize(s.width,s.height).setScale(1.35).setName("arrow"),this.sound.play("enabled-unit");const a=this.rng.integerInRange(1,3);h&&this.sound.stopByKey(h),this.sound.playAudioSprite(t.getInternalHero().name+" quotes",a.toString(),{volume:.2}),this.displayRanges(e,t.getMovementRange(),t.getWeaponRange())}));let d="";const m=new a.GameObjects.Image(this,0,0,"end-arrow").setName("end-arrow");this.movementArrows.add(m);let p="";t.on("dragover",((e,s)=>{var a,o;if(s.name!==p)if(p=s.name,this.walkCoords.includes(s.name)&&s.name!==d){this.sound.play("hover");const e=s.name.split("-").map(Number),a=this.buildArrowPath(Object.assign({},n),{x:e[0],y:e[1]},t);l.setTexture("rosary"),t.getInternalHero().coordinates=a[a.length-1],this.movementArrows.clear(!0);for(let e=0;e<a.length;e++){const t=a[e-1],s=a[e];if(e&&this.add.existing(m),t&&a[e-2]){const o=he(a[e-2],s),n=this.getTile(t.x+"-"+t.y);var i=o.x?o.y?`path-${o.y}-${o.x}`:"horizontal":"vertical";const r=new Phaser.GameObjects.Image(this,n.x,n.y,i);this.add.existing(r),this.movementArrows.add(r)}if(1===e){const e=he(t,s),a="up"===e.y?180:"down"===e.y?0:null,o="left"===e.x?90:"right"===e.x?-90:null,n=null!=a?a:o;l.setTexture("rosary-arrow"),l.setRotation(n*Math.PI/180)}if(1===a.length)this.children.remove(this.children.getByName("end-arrow"));else if(e===a.length-1&&e){const e=a[a.length-1],s=this.getTile(e.x+"-"+e.y);m.x=s.x,m.y=s.y;const o=he(t,e),n="left"===o.x?180:"right"===o.x?0:null,i="up"===o.y?-90:"down"===o.y?90:null,r=null!=n?n:i;m.setRotation(r*Math.PI/180)}}d=s.name,this.children.getByName(`movement-${t.getInternalHero().name}`).x=s.x,this.children.getByName(`movement-${t.getInternalHero().name}`).y=s.y}else if(this.attackCoords.includes(s.name)){const[e,n]=s.name.split("-");if((null!==(o=null===(a=this.map[+n][+e])||void 0===a?void 0:a.team)&&void 0!==o?o:t.team)!==t.team){const s=this.map[+n][+e];se.startCombat(t.getInternalHero(),s.getInternalHero())}}})),t.off("dragend"),t.on("dragend",(({upX:e,upY:s})=>{const{x:a,y:i}=ne(e,s);if(this.movementArrows.setVisible(!1),this.children.remove(this.children.getByName("arrow")),this.children.remove(this.children.getByName("end-arrow")),!this.walkCoords.includes(a+"-"+i)||this.map[i][a]||n.x===a&&n.y===i)if(this.attackCoords.includes(a+"-"+i)&&this.map[i][a]&&this.map[i][a].team!==t.team){const e=this.getTilesInShallowRange({x:a,y:i},t.getWeaponRange()),[s]=de(Array.from(e.keys()),this.walkCoords),[r,l]=s.split("-");this.moveHero(t,n,{x:+r,y:+l}),n.x=+r,n.y=+l;const h=this.map[i][a],d=se.startCombat(t.getInternalHero(),h.getInternalHero()),m=this.tweens.timeline();m.on("complete",(()=>{this.clearTiles([...this.walkCoords,...this.attackCoords]);const e=[t,h].find((e=>0===e.getInternalHero().stats.hp));e&&this.tweens.add({targets:e,alpha:0,delay:700,onStart:()=>{this.sound.play("ko",{volume:.4})},onComplete:()=>{this.game.input.enabled=!0}})}));for(let e=0;e<d.outcome.length;e++){const t=d.outcome[e],s=this.children.getByName(t.defender.id),a=this.children.getByName(t.attacker.id),n=s.image.getCenter(),i=o(this,s.x+n.x,s.y+n.y,t.damage.toString(),{stroke:"#FFFFFF",strokeThickness:5,color:"red",fontSize:"advantage"===t.advantage||t.effective?"32px":"disadvantage"===t.advantage?"25px":"30px"}).setOrigin(.4).setDepth(3);m.add({targets:a,x:"-="+(a.x-s.x)/2,y:"-="+(a.y-s.y)/2,yoyo:!0,duration:100,onStart:()=>{this.sound.play("hit"),this.add.existing(i),this.tweens.add({targets:[i],y:s.image.getTopCenter().y+s.y,yoyo:!0,duration:100,onComplete:()=>{setTimeout((()=>{i.destroy()}),500)},onStart:()=>{s.getInternalHero().stats.hp=t.remainingHP}})},delay:500})}this.game.input.enabled=!1,m.play()}else{const e=oe(n.x,n.y);this.tweens.add({targets:t,x:e.x,y:e.y,duration:100}),t.getInternalHero().coordinates=Object.assign({},n)}else{this.clearTiles([...this.walkCoords,...this.attackCoords]),this.map[n.y][n.x]=null,n.x=a,n.y=i,this.map[n.y][n.x]=t;const e=oe(a,i);t.x=e.x,t.y=e.y,se.moveHero(t.getInternalHero(),{x:a,y:i}),this.movementArrows.setVisible(!1),this.movementArrows.clear(!0),this.movementAllowedImages.setVisible(!0),this.children.getByName(`movement-${t.getInternalHero().name}`).setVisible(!1),this.sound.play("confirm",{volume:.4}),this.endAction(t),this.children.remove(m)}}))}for(let e of this[t])e.off("dragover"),e.off("dragend"),e.setInteractive(),this.children.remove(this.children.getByName("movement-"+e.getInternalHero().name)),e.image.clearTint(),this.input.setDraggable(e,!1),e.off("dragstart"),e.off("pointerdown"),e.on("pointerdown",(()=>{this.displayRanges(ne(e.x,e.y),e.getMovementRange(),e.getWeaponRange()),this.sound.play("enabled-unit"),this.highlightedHero=e}));for(let e of s){const t=this.children.getByName(e.targetHeroId);e.appliedEffect.stats&&(t.getInternalHero().setMapMods(e.appliedEffect.stats),console.log(t))}}preload(){this.load.image("map","assets/map.webp"),this.load.image("movement-allowed","assets/movement-allowed.png"),this.load.atlas("weapons","assets/sheets/weapons.webp","assets/sheets/weapons.json"),this.load.atlas("skills","assets/sheets/skills.webp","assets/sheets/skills.json"),this.load.audio("enabled-unit","assets/audio/pointer-tap.mp3"),this.load.audio("disabled-unit","assets/audio/feh disabled unit.mp3"),this.load.audio("hit","assets/audio/hit.mp3"),this.load.audio("ko","assets/audio/ko.mp3"),this.load.image("test","assets/unit-bg-test.png"),this.load.audio("hover","assets/audio/hover on tile.mp3"),this.load.audio("confirm","assets/audio/confirm.mp3"),this.load.image("nameplate","assets/nameplate.png"),this.load.image("end-arrow","assets/end-arrow-fixed.png"),this.load.image("path-down-right","assets/path-down-left.png"),this.load.image("path-down-left","assets/path-down-right.png"),this.load.image("path-up-right","assets/path-up-right.png"),this.load.image("path-up-left","assets/path-up-left.png"),this.load.image("buff","assets/buff-arrow.png"),this.load.image("horizontal","assets/horizontal.png"),this.load.image("vertical","assets/vertical-fixed.png"),this.load.image("unit-bg","assets/unitbg.png"),this.load.image("rosary","assets/rosary-current.png"),this.load.image("rosary-arrow","assets/rosary-arrow.png"),this.load.image("weapon-icon","assets/weapon_icon.png"),this.load.image("weapon-bg","assets/weapon.png"),this.load.image("assist-icon","assets/assist-icon.png"),this.load.image("special-icon","assets/special-icon.png"),this.load.audio("bgm","assets/audio/leif's army in search of victory.ogg");for(let e of["Corrin","Hector","Ike","Lucina","Lyn","Robin","Ryoma","Ephraim"])this.load.atlas(e,`assets/battle/${e}.webp`,`assets/battle/${e}.json`),this.load.audioSprite(`${e} quotes`,`assets/audio/quotes/${e}.json`,`assets/audio/quotes/${e}.m4a`);this.load.image("hp plate","assets/hp plate.png"),this.load.image("stat-line","assets/stat-glowing-line.png");for(let e of["A","B","C","S"])this.load.image(e,`assets/${e}.png`)}addHero(e,t){const{x:s,y:a}=oe(e.x,e.y),o=new i(this,s,a,e.hero,t).setInteractive();return this.add.existing(o),this.heroes.push(o),this.map[e.y][e.x]=o,this[t].push(o),o}moveHero(e,t,s){this.map[t.y][t.x]=null,this.map[s.y][s.x]=e;const{x:a,y:o}=oe(s.x,s.y);e.x=a,e.y=o}getNearestToAttackTile(e,t){const s=this.getTilesInShallowRange(t,e.getWeaponRange());return s.size?s:null}create(){this.fps=this.add.text(90,90,""),this.movementAllowedImages=this.add.group(),this.movementArrows=this.add.group(),this.add.image(0,0,"test").setOrigin(0).setTint(4338770),this.add.image(0,150,"map").setDisplaySize(750,1e3).setOrigin(0,0);for(let e=1;e<9;e++)for(let t=1;t<7;t++){const{x:s,y:a}=oe(t,e),o=t+"-"+e,n=this.add.rectangle(s,a,ae,ae,0).setAlpha(.2).setName(o).setInteractive(void 0,void 0,!0);n.on("pointerdown",(()=>{const[e,t]=o.split("-");this.map[+t][+e]||(this.clearTiles([...this.walkCoords,...this.attackCoords]),this.displayRange&&this.sound.play("disabled-unit"),this.displayRange=!1,this.movementAllowedImages.setVisible(!0),this.movementAllowedTween.resume(),this.movementArrows.clear(!0))})),this.add.text(n.getCenter().x,n.getCenter().y,o,{fontSize:"18px"})}for(let{hero:e,x:t,y:s}of se.team1)this.addHero({x:t,y:s,hero:e},"team1");for(let{hero:e,x:t,y:s}of se.team2)this.addHero({hero:e,x:t,y:s},"team2");this.input.on("drag",((e,t,s,a)=>{t instanceof i&&t.team===this.turn&&(t.x=s,t.y=a)})),this.setTurn("team1")}displayRanges(e,t,s){this.displayRange=!0;const a=this.getTilesInRange(e,t);for(let[t,s]of a.entries())this.heroCanReachTile(this.map[e.y][e.x],s)||a.delete(t);const o=function(e,t){const s=new Map;for(let[a,o]of e.entries())t.has(a)||s.set(a,o);for(let[a,o]of t.entries())e.has(a)||s.set(a,o);return s}(a,this.getTilesInRange(e,s,a,!0)),n=Array.from(a.keys()),i=Array.from(o.keys());for(let e of this.walkCoords)n.includes(e)||this.getTile(e).setFillStyle(0);for(let e of this.attackCoords)i.includes(e)||this.getTile(e).setFillStyle(0);this.walkCoords=n,this.attackCoords=i,this.fillTiles(this.walkCoords,255),this.fillTiles(this.attackCoords,16711680)}getTile(e){return this.children.getByName(e)}getTilesInRange(e,t,s,o){new a.Structs.Set;let n=s?Array.from(s.values()):[e];const i=s?new Map(s||void 0):new Map,r=this.map[e.y][e.x];for(let e=0;e<t;e++)n=n.map(le).flat(),o||(n=n.filter((e=>this.heroCanReachTile(r,e))));for(let e of n)i.has(`${e.x}-${e.y}`)||i.set(`${e.x}-${e.y}`,e);return i}getTilesInShallowRange(e,t){const s=this.getTilesInRange(e,t);return s.forEach(((a,o)=>{this.getDistance(a,e)!==t&&s.delete(o)})),s}getDistance(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}heroCanReachTile(e,t){const s=this.map[t.y][t.x];if(Boolean(s)&&s.team!==e.team)return!1;const a=this.terrain[t.y-1][t.x-1];if("wall"===a)return!1;if("void"===a)return"flier"===e.getInternalHero().movementType;if("flier"===e.getInternalHero().movementType)return!0;const{x:o,y:n}=ne(e.x,e.y);if("cavalry"===e.getInternalHero().movementType&&"trench"===a)return this.getDistance({x:o,y:n},t)<=1;if("tree"===a)switch(e.getInternalHero().movementType){case"cavalry":return!1;case"infantry":return this.getDistance({x:o,y:n},t)<=1;default:return!0}return!0}update(){this.fps.setText(this.sys.game.loop.actualFps.toString());for(let e of this.heroes)e.update();if(this.heroesWhoMoved.length===this[this.turn].length){const e="team1"===this.turn?"team2":"team1";this.setTurn(e)}}}function re(e){return e.x>=1&&e.x<=6&&e.y>=1&&e.y<=8}function le(e){const{x:t,y:s}=e,a=[e];return a.push({x:t+1,y:s}),a.push({x:t-1,y:s}),a.push({x:t,y:s+1}),a.push({x:t,y:s-1}),a.filter(re)}function he(e,t){const s={y:"",x:""};return e.y!==t.y&&(s.y=e.y<t.y?"down":"up"),e.x!==t.x&&(s.x=e.x<t.x?"right":"left"),s}function de(e,t){const s=[];for(let a of e)t.includes(a)&&s.push(a);for(let a of t)e.includes(a)&&s.push(a);return Array.from(new Set(s))}class me extends Phaser.Scene{constructor(){super({key:"PreloadScene"})}create(){this.scene.start("MainScene")}}const pe={type:Phaser.CANVAS,backgroundColor:"#000",fps:{forceSetTimeout:!0,target:15,min:15},scale:{parent:"phaser-game",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:750,height:1200},scene:[me,ie]};window.addEventListener("load",(()=>{new Phaser.Game(pe)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function a(e){var o=s[e];if(void 0!==o)return o.exports;var n=s[e]={id:e,loaded:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.loaded=!0,n.exports}a.m=t,e=[],a.O=(t,s,o,n)=>{if(!s){var i=1/0;for(d=0;d<e.length;d++){for(var[s,o,n]=e[d],r=!0,l=0;l<s.length;l++)(!1&n||i>=n)&&Object.keys(a.O).every((e=>a.O[e](s[l])))?s.splice(l--,1):(r=!1,n<i&&(i=n));if(r){e.splice(d--,1);var h=o();void 0!==h&&(t=h)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[s,o,n]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e={179:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var o,n,[i,r,l]=s,h=0;if(i.some((t=>0!==e[t]))){for(o in r)a.o(r,o)&&(a.m[o]=r[o]);if(l)var d=l(a)}for(t&&t(s);h<i.length;h++)n=i[h],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(d)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),a.O(void 0,[216],(()=>a(775)));var o=a.O(void 0,[216],(()=>a(204)));o=a.O(o)})();